<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Blockchain.Fae.Internal.Transaction</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Blockchain.Fae.Internal.Transaction.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">fae-2.0.0.0</p></div><div id="content"><div id="module-header"><table class="info"><tr><th valign="top">Copyright</th><td>(c) Ryan Reich 2017-2018</td></tr><tr><th>License</th><td>MIT</td></tr><tr><th>Maintainer</th><td>ryan.reich@gmail.com</td></tr><tr><th>Stability</th><td>experimental</td></tr><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Blockchain.Fae.Internal.Transaction</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Types</a></li><li><a href="#g:2">Typeclasses</a></li><li><a href="#g:3">Functions</a><ul><li><a href="#g:4">Running transactions</a></li><li><a href="#g:5">Running contracts</a></li></ul></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>This module provides the code that navigates the intricacies of executing a transaction.  It is useful for front-end implementations, but not to users.</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">type</span> <a href="#t:Inputs">Inputs</a> = [(<a href="Blockchain-Fae-Internal-IDs-Types.html#t:ContractID">ContractID</a>, <a href="../base-4.10.1.0/Data-String.html#t:String">String</a>, <a href="Blockchain-Fae-Internal-IDs-Types.html#t:Renames">Renames</a>)]</li><li class="src short"><span class="keyword">type</span> <a href="#t:TXStorageM">TXStorageM</a> = <a href="Blockchain-Fae-Internal-Storage.html#t:FaeStorageT">FaeStorageT</a> <a href="Blockchain-Fae-Internal-Contract.html#t:FaeTXM">FaeTXM</a></li><li class="src short"><span class="keyword">class</span> (<a href="Blockchain-Fae-Internal-Exceptions.html#t:Typeable">Typeable</a> (<a href="Blockchain-Fae-Internal-Transaction.html#t:TransactionResult">TransactionResult</a> f), <a href="../base-4.10.1.0/Text-Show.html#t:Show">Show</a> (<a href="Blockchain-Fae-Internal-Transaction.html#t:TransactionResult">TransactionResult</a> f)) =&gt; <a href="#t:TransactionBody">TransactionBody</a> f <span class="keyword">where</span><ul class="subs"><li><span class="keyword">type</span> <a href="#t:TransactionResult">TransactionResult</a> f :: <a href="../base-4.10.1.0/Data-Kind.html#t:-42-">*</a></li><li><span class="keyword">type</span> <a href="#t:TransactionFallback">TransactionFallback</a> f :: <a href="../base-4.10.1.0/Data-Kind.html#t:-42-">*</a></li></ul></li><li class="src short"><span class="keyword">type</span> <a href="#t:TransactionConstraints">TransactionConstraints</a> f = (<a href="Blockchain-Fae-Internal-Transaction.html#t:TransactionBody">TransactionBody</a> f, <a href="Blockchain-Fae-Internal-Transaction.html#t:TransactionBody">TransactionBody</a> (<a href="Blockchain-Fae-Internal-Transaction.html#t:TransactionFallback">TransactionFallback</a> f))</li><li class="src short"><a href="#v:runTransaction">runTransaction</a> :: <a href="Blockchain-Fae-Internal-Transaction.html#t:TransactionConstraints">TransactionConstraints</a> f =&gt; f -&gt; [<a href="Blockchain-Fae-Internal-Transaction.html#t:TransactionFallback">TransactionFallback</a> f] -&gt; <a href="Blockchain-Fae-Internal-Transaction.html#t:Inputs">Inputs</a> -&gt; <a href="Blockchain-Fae-Internal-IDs-Types.html#t:TransactionID">TransactionID</a> -&gt; <a href="Blockchain-Fae-Internal-IDs-Types.html#t:Signers">Signers</a> -&gt; <a href="../base-4.10.1.0/Data-Bool.html#t:Bool">Bool</a> -&gt; <a href="Blockchain-Fae-Internal-Storage.html#t:FaeStorage">FaeStorage</a> ()</li><li class="src short"><a href="#v:runTransactionBody">runTransactionBody</a> :: <a href="Blockchain-Fae-Internal-Transaction.html#t:TransactionConstraints">TransactionConstraints</a> f =&gt; <a href="../base-4.10.1.0/Data-Bool.html#t:Bool">Bool</a> -&gt; f -&gt; [<a href="Blockchain-Fae-Internal-Transaction.html#t:TransactionFallback">TransactionFallback</a> f] -&gt; [<a href="Blockchain-Fae-Internal-Contract.html#t:ReturnValue">ReturnValue</a>] -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeTXM">FaeTXM</a> (<a href="Blockchain-Fae-Internal-Storage.html#t:Result">Result</a>, <a href="Blockchain-Fae-Internal-Storage.html#t:Outputs">Outputs</a>)</li><li class="src short"><a href="#v:doTX">doTX</a> :: <a href="Blockchain-Fae-Internal-Transaction.html#t:TransactionConstraints">TransactionConstraints</a> f =&gt; f -&gt; [<a href="Blockchain-Fae-Internal-Transaction.html#t:TransactionFallback">TransactionFallback</a> f] -&gt; [<a href="Blockchain-Fae-Internal-Contract.html#t:ReturnValue">ReturnValue</a>] -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeTXM">FaeTXM</a> (<a href="Blockchain-Fae-Internal-Storage.html#t:Result">Result</a>, <a href="Blockchain-Fae-Internal-Storage.html#t:Outputs">Outputs</a>)</li><li class="src short"><a href="#v:doFallbacks">doFallbacks</a> :: <a href="Blockchain-Fae-Internal-Transaction.html#t:TransactionBody">TransactionBody</a> g =&gt; [g] -&gt; [<a href="Blockchain-Fae-Internal-Contract.html#t:ReturnValue">ReturnValue</a>] -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeTXM">FaeTXM</a> [<a href="Blockchain-Fae-Internal-Contract.html#t:Output">Output</a>]</li><li class="src short"><a href="#v:callTX">callTX</a> :: <a href="Blockchain-Fae-Internal-Transaction.html#t:TransactionBody">TransactionBody</a> f =&gt; ([<a href="Blockchain-Fae-Internal-Contract.html#t:ReturnValue">ReturnValue</a>] -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeTXM">FaeTXM</a> [<a href="Blockchain-Fae-Internal-Contract.html#t:Output">Output</a>]) -&gt; [<a href="Blockchain-Fae-Internal-Contract.html#t:ReturnValue">ReturnValue</a>] -&gt; f -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeTXM">FaeTXM</a> (<a href="Blockchain-Fae-Internal-Storage.html#t:Result">Result</a>, [<a href="Blockchain-Fae-Internal-Contract.html#t:Output">Output</a>])</li><li class="src short"><a href="#v:runInputContracts">runInputContracts</a> :: <a href="Blockchain-Fae-Internal-Transaction.html#t:Inputs">Inputs</a> -&gt; <a href="Blockchain-Fae-Internal-Transaction.html#t:TXStorageM">TXStorageM</a> (<a href="../vector-0.12.0.1/Data-Vector.html#t:Vector">Vector</a> <a href="Blockchain-Fae-Internal-Storage.html#t:InputResults">InputResults</a>)</li><li class="src short"><a href="#v:nextInput">nextInput</a> :: <a href="Blockchain-Fae-Internal-Versions.html#t:InputVersionMap">InputVersionMap</a> -&gt; (<a href="Blockchain-Fae-Internal-IDs-Types.html#t:ContractID">ContractID</a>, <a href="../base-4.10.1.0/Data-String.html#t:String">String</a>, <a href="Blockchain-Fae-Internal-IDs-Types.html#t:Renames">Renames</a>) -&gt; <a href="Blockchain-Fae-Internal-Transaction.html#t:TXStorageM">TXStorageM</a> <a href="Blockchain-Fae-Internal-Storage.html#t:InputResults">InputResults</a></li><li class="src short"><a href="#v:contractCallResult">contractCallResult</a> :: <a href="Blockchain-Fae-Internal-Versions.html#t:InputVersionMap">InputVersionMap</a> -&gt; <a href="../base-4.10.1.0/Data-String.html#t:String">String</a> -&gt; <a href="Blockchain-Fae-Internal-IDs-Types.html#t:Renames">Renames</a> -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:OutputData">OutputData</a> -&gt; <a href="Blockchain-Fae-Internal-IDs-Types.html#t:ContractID">ContractID</a> -&gt; <a href="Blockchain-Fae-Internal-Transaction.html#t:TXStorageM">TXStorageM</a> <a href="Blockchain-Fae-Internal-Storage.html#t:InputResults">InputResults</a></li><li class="src short"><a href="#v:importedCallResult">importedCallResult</a> :: <a href="Blockchain-Fae-Internal-Storage.html#t:InputResults">InputResults</a> -&gt; <a href="Blockchain-Fae-Internal-IDs-Types.html#t:ContractID">ContractID</a> -&gt; <a href="Blockchain-Fae-Internal-Transaction.html#t:TXStorageM">TXStorageM</a> <a href="Blockchain-Fae-Internal-Storage.html#t:InputResults">InputResults</a></li><li class="src short"><a href="#v:errInputResult">errInputResult</a> :: <a href="Blockchain-Fae-Internal-IDs-Types.html#t:ContractID">ContractID</a> -&gt; <a href="Blockchain-Fae-Internal-Transaction.html#t:TXStorageM">TXStorageM</a> <a href="Blockchain-Fae-Internal-Storage.html#t:InputResults">InputResults</a></li><li class="src short"><a href="#v:runContract">runContract</a> :: <a href="Blockchain-Fae-Internal-IDs-Types.html#t:ContractID">ContractID</a> -&gt; <a href="Blockchain-Fae-Internal-Versions.html#t:InputVersionMap">InputVersionMap</a> -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:AbstractGlobalContract">AbstractGlobalContract</a> -&gt; <a href="../base-4.10.1.0/Data-String.html#t:String">String</a> -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeTXM">FaeTXM</a> (<a href="Blockchain-Fae-Internal-Storage.html#t:InputResults">InputResults</a>, <a href="../base-4.10.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Blockchain-Fae-Internal-Contract.html#t:AbstractGlobalContract">AbstractGlobalContract</a>)</li></ul></div><div id="interface"><h1 id="g:1">Types</h1><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:Inputs" class="def">Inputs</a> = [(<a href="Blockchain-Fae-Internal-IDs-Types.html#t:ContractID">ContractID</a>, <a href="../base-4.10.1.0/Data-String.html#t:String">String</a>, <a href="Blockchain-Fae-Internal-IDs-Types.html#t:Renames">Renames</a>)] <a href="src/Blockchain.Fae.Internal.Transaction.html#Inputs" class="link">Source</a> <a href="#t:Inputs" class="selflink">#</a></p><div class="doc"><p>How inputs are provided to transactions.  The contract with a given ID
 gets an argument and a (possibly empty) remapping of signer names.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:TXStorageM" class="def">TXStorageM</a> = <a href="Blockchain-Fae-Internal-Storage.html#t:FaeStorageT">FaeStorageT</a> <a href="Blockchain-Fae-Internal-Contract.html#t:FaeTXM">FaeTXM</a> <a href="src/Blockchain.Fae.Internal.Transaction.html#TXStorageM" class="link">Source</a> <a href="#t:TXStorageM" class="selflink">#</a></p><div class="doc"><p>Transaction monad with storage access, for executing contracts and
 saving the results.</p></div></div><h1 id="g:2">Typeclasses</h1><div class="top"><p class="src"><span class="keyword">class</span> (<a href="Blockchain-Fae-Internal-Exceptions.html#t:Typeable">Typeable</a> (<a href="Blockchain-Fae-Internal-Transaction.html#t:TransactionResult">TransactionResult</a> f), <a href="../base-4.10.1.0/Text-Show.html#t:Show">Show</a> (<a href="Blockchain-Fae-Internal-Transaction.html#t:TransactionResult">TransactionResult</a> f)) =&gt; <a id="t:TransactionBody" class="def">TransactionBody</a> f <span class="keyword">where</span> <a href="src/Blockchain.Fae.Internal.Transaction.html#TransactionBody" class="link">Source</a> <a href="#t:TransactionBody" class="selflink">#</a></p><div class="doc"><p>This class, and its only instances, define what a transaction function
 must look like: essentially, any function of the form</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>body :: a -&gt; b -&gt; ... -&gt; FaeTX result
</code></strong></pre><p>where the argument types correspond, in order, to the return types of
 the transaction's input contracts.  Correspondingly, any fallback
 functions must have the signature</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>fallback :: a -&gt; b -&gt; ... -&gt; FaeTX ()
</code></strong></pre><p>though other return value types are accepted, and ignored.</p></div><div class="subs minimal"><p class="caption">Minimal complete definition</p><p class="src"><a href="Blockchain-Fae-Internal-Transaction.html#v:callTransactionBody">callTransactionBody</a></p></div><div class="subs associated-types"><p class="caption">Associated Types</p><p class="src"><span class="keyword">type</span> <a id="t:TransactionResult" class="def">TransactionResult</a> f :: <a href="../base-4.10.1.0/Data-Kind.html#t:-42-">*</a> <a href="src/Blockchain.Fae.Internal.Transaction.html#TransactionResult" class="link">Source</a> <a href="#t:TransactionResult" class="selflink">#</a></p><p class="src"><span class="keyword">type</span> <a id="t:TransactionFallback" class="def">TransactionFallback</a> f :: <a href="../base-4.10.1.0/Data-Kind.html#t:-42-">*</a> <a href="src/Blockchain.Fae.Internal.Transaction.html#TransactionFallback" class="link">Source</a> <a href="#t:TransactionFallback" class="selflink">#</a></p></div><div class="subs methods"><p class="caption">Methods</p><p class="src"><a id="v:callTransactionBody" class="def">callTransactionBody</a> :: f -&gt; [<a href="Blockchain-Fae-Internal-Contract.html#t:ReturnValue">ReturnValue</a>] -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeTX">FaeTX</a> (<a href="Blockchain-Fae-Internal-Transaction.html#t:TransactionResult">TransactionResult</a> f) <a href="src/Blockchain.Fae.Internal.Transaction.html#callTransactionBody" class="link">Source</a> <a href="#v:callTransactionBody" class="selflink">#</a></p></div><div class="subs instances"><p id="control.i:TransactionBody" class="caption collapser" onclick="toggleSection('i:TransactionBody')">Instances</p><div id="section.i:TransactionBody" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:ic:TransactionBody:TransactionBody:1" class="instance expander" onclick="toggleSection('i:ic:TransactionBody:TransactionBody:1')"></span> (<a href="Blockchain-Fae-Internal-Exceptions.html#t:Typeable">Typeable</a> <a href="../base-4.10.1.0/Data-Kind.html#t:-42-">*</a> a, <a href="../base-4.10.1.0/Text-Show.html#t:Show">Show</a> a) =&gt; <a href="Blockchain-Fae-Internal-Transaction.html#t:TransactionBody">TransactionBody</a> (<a href="Blockchain-Fae-Internal-Contract.html#t:FaeTX">FaeTX</a> a)</span> <a href="src/Blockchain.Fae.Internal.Transaction.html#line-82" class="link">Source</a> <a href="#t:TransactionBody" class="selflink">#</a></td><td class="doc"><p>The base-case instance: a transaction with no arguments.</p></td></tr><tr><td colspan="2"><div id="section.i:ic:TransactionBody:TransactionBody:1" class="inst-details hide"><div class="subs associated-types"><p class="caption">Associated Types</p><p class="src"><span class="keyword">type</span> <a href="Blockchain-Fae-Internal-Transaction.html#t:TransactionResult">TransactionResult</a> (<a href="Blockchain-Fae-Internal-Contract.html#t:FaeTX">FaeTX</a> a) :: <a href="../base-4.10.1.0/Data-Kind.html#t:-42-">*</a> <a href="src/Blockchain.Fae.Internal.Transaction.html#TransactionResult" class="link">Source</a> <a href="#t:TransactionResult" class="selflink">#</a></p><p class="src"><span class="keyword">type</span> <a href="Blockchain-Fae-Internal-Transaction.html#t:TransactionFallback">TransactionFallback</a> (<a href="Blockchain-Fae-Internal-Contract.html#t:FaeTX">FaeTX</a> a) :: <a href="../base-4.10.1.0/Data-Kind.html#t:-42-">*</a> <a href="src/Blockchain.Fae.Internal.Transaction.html#TransactionFallback" class="link">Source</a> <a href="#t:TransactionFallback" class="selflink">#</a></p></div> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:callTransactionBody">callTransactionBody</a> :: <a href="Blockchain-Fae-Internal-Contract.html#t:FaeTX">FaeTX</a> a -&gt; [<a href="Blockchain-Fae-Internal-Contract.html#t:ReturnValue">ReturnValue</a>] -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeTX">FaeTX</a> (<a href="Blockchain-Fae-Internal-Transaction.html#t:TransactionResult">TransactionResult</a> (<a href="Blockchain-Fae-Internal-Contract.html#t:FaeTX">FaeTX</a> a)) <a href="src/Blockchain.Fae.Internal.Transaction.html#callTransactionBody" class="link">Source</a> <a href="#v:callTransactionBody" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:ic:TransactionBody:TransactionBody:2" class="instance expander" onclick="toggleSection('i:ic:TransactionBody:TransactionBody:2')"></span> (<a href="Blockchain-Fae-Internal-Transaction.html#t:TransactionBody">TransactionBody</a> f, <a href="Blockchain-Fae-Internal-Exceptions.html#t:Typeable">Typeable</a> <a href="../base-4.10.1.0/Data-Kind.html#t:-42-">*</a> a) =&gt; <a href="Blockchain-Fae-Internal-Transaction.html#t:TransactionBody">TransactionBody</a> (a -&gt; f)</span> <a href="src/Blockchain.Fae.Internal.Transaction.html#line-89" class="link">Source</a> <a href="#t:TransactionBody" class="selflink">#</a></td><td class="doc"><p>The inductive-case instance: a transaction with one more argument.</p></td></tr><tr><td colspan="2"><div id="section.i:ic:TransactionBody:TransactionBody:2" class="inst-details hide"><div class="subs associated-types"><p class="caption">Associated Types</p><p class="src"><span class="keyword">type</span> <a href="Blockchain-Fae-Internal-Transaction.html#t:TransactionResult">TransactionResult</a> (a -&gt; f) :: <a href="../base-4.10.1.0/Data-Kind.html#t:-42-">*</a> <a href="src/Blockchain.Fae.Internal.Transaction.html#TransactionResult" class="link">Source</a> <a href="#t:TransactionResult" class="selflink">#</a></p><p class="src"><span class="keyword">type</span> <a href="Blockchain-Fae-Internal-Transaction.html#t:TransactionFallback">TransactionFallback</a> (a -&gt; f) :: <a href="../base-4.10.1.0/Data-Kind.html#t:-42-">*</a> <a href="src/Blockchain.Fae.Internal.Transaction.html#TransactionFallback" class="link">Source</a> <a href="#t:TransactionFallback" class="selflink">#</a></p></div> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:callTransactionBody">callTransactionBody</a> :: (a -&gt; f) -&gt; [<a href="Blockchain-Fae-Internal-Contract.html#t:ReturnValue">ReturnValue</a>] -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeTX">FaeTX</a> (<a href="Blockchain-Fae-Internal-Transaction.html#t:TransactionResult">TransactionResult</a> (a -&gt; f)) <a href="src/Blockchain.Fae.Internal.Transaction.html#callTransactionBody" class="link">Source</a> <a href="#v:callTransactionBody" class="selflink">#</a></p></div></div></td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:TransactionConstraints" class="def">TransactionConstraints</a> f = (<a href="Blockchain-Fae-Internal-Transaction.html#t:TransactionBody">TransactionBody</a> f, <a href="Blockchain-Fae-Internal-Transaction.html#t:TransactionBody">TransactionBody</a> (<a href="Blockchain-Fae-Internal-Transaction.html#t:TransactionFallback">TransactionFallback</a> f)) <a href="src/Blockchain.Fae.Internal.Transaction.html#TransactionConstraints" class="link">Source</a> <a href="#t:TransactionConstraints" class="selflink">#</a></p><div class="doc"><p>A little more concise than its expansion.</p></div></div><h1 id="g:3">Functions</h1><h2 id="g:4">Running transactions</h2><div class="top"><p class="src"><a id="v:runTransaction" class="def">runTransaction</a> :: <a href="Blockchain-Fae-Internal-Transaction.html#t:TransactionConstraints">TransactionConstraints</a> f =&gt; f -&gt; [<a href="Blockchain-Fae-Internal-Transaction.html#t:TransactionFallback">TransactionFallback</a> f] -&gt; <a href="Blockchain-Fae-Internal-Transaction.html#t:Inputs">Inputs</a> -&gt; <a href="Blockchain-Fae-Internal-IDs-Types.html#t:TransactionID">TransactionID</a> -&gt; <a href="Blockchain-Fae-Internal-IDs-Types.html#t:Signers">Signers</a> -&gt; <a href="../base-4.10.1.0/Data-Bool.html#t:Bool">Bool</a> -&gt; <a href="Blockchain-Fae-Internal-Storage.html#t:FaeStorage">FaeStorage</a> () <a href="src/Blockchain.Fae.Internal.Transaction.html#runTransaction" class="link">Source</a> <a href="#v:runTransaction" class="selflink">#</a></p><div class="doc"><p>Runs a transaction on its inputs, with some basic information about
 the context.</p></div></div><div class="top"><p class="src"><a id="v:runTransactionBody" class="def">runTransactionBody</a> :: <a href="Blockchain-Fae-Internal-Transaction.html#t:TransactionConstraints">TransactionConstraints</a> f =&gt; <a href="../base-4.10.1.0/Data-Bool.html#t:Bool">Bool</a> -&gt; f -&gt; [<a href="Blockchain-Fae-Internal-Transaction.html#t:TransactionFallback">TransactionFallback</a> f] -&gt; [<a href="Blockchain-Fae-Internal-Contract.html#t:ReturnValue">ReturnValue</a>] -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeTXM">FaeTXM</a> (<a href="Blockchain-Fae-Internal-Storage.html#t:Result">Result</a>, <a href="Blockchain-Fae-Internal-Storage.html#t:Outputs">Outputs</a>) <a href="src/Blockchain.Fae.Internal.Transaction.html#runTransactionBody" class="link">Source</a> <a href="#v:runTransactionBody" class="selflink">#</a></p><div class="doc"><p>Before calling the transaction function, optionally adds a reward
 value to the inputs.</p></div></div><div class="top"><p class="src"><a id="v:doTX" class="def">doTX</a> :: <a href="Blockchain-Fae-Internal-Transaction.html#t:TransactionConstraints">TransactionConstraints</a> f =&gt; f -&gt; [<a href="Blockchain-Fae-Internal-Transaction.html#t:TransactionFallback">TransactionFallback</a> f] -&gt; [<a href="Blockchain-Fae-Internal-Contract.html#t:ReturnValue">ReturnValue</a>] -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeTXM">FaeTXM</a> (<a href="Blockchain-Fae-Internal-Storage.html#t:Result">Result</a>, <a href="Blockchain-Fae-Internal-Storage.html#t:Outputs">Outputs</a>) <a href="src/Blockchain.Fae.Internal.Transaction.html#doTX" class="link">Source</a> <a href="#v:doTX" class="selflink">#</a></p><div class="doc"><p>Actually execute the transaction function, followed if necessary by
 the fallbacks.</p></div></div><div class="top"><p class="src"><a id="v:doFallbacks" class="def">doFallbacks</a> :: <a href="Blockchain-Fae-Internal-Transaction.html#t:TransactionBody">TransactionBody</a> g =&gt; [g] -&gt; [<a href="Blockchain-Fae-Internal-Contract.html#t:ReturnValue">ReturnValue</a>] -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeTXM">FaeTXM</a> [<a href="Blockchain-Fae-Internal-Contract.html#t:Output">Output</a>] <a href="src/Blockchain.Fae.Internal.Transaction.html#doFallbacks" class="link">Source</a> <a href="#v:doFallbacks" class="selflink">#</a></p><div class="doc"><p>Performs all fallback transactions, ignoring return values and errors.</p></div></div><div class="top"><p class="src"><a id="v:callTX" class="def">callTX</a> :: <a href="Blockchain-Fae-Internal-Transaction.html#t:TransactionBody">TransactionBody</a> f =&gt; ([<a href="Blockchain-Fae-Internal-Contract.html#t:ReturnValue">ReturnValue</a>] -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeTXM">FaeTXM</a> [<a href="Blockchain-Fae-Internal-Contract.html#t:Output">Output</a>]) -&gt; [<a href="Blockchain-Fae-Internal-Contract.html#t:ReturnValue">ReturnValue</a>] -&gt; f -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeTXM">FaeTXM</a> (<a href="Blockchain-Fae-Internal-Storage.html#t:Result">Result</a>, [<a href="Blockchain-Fae-Internal-Contract.html#t:Output">Output</a>]) <a href="src/Blockchain.Fae.Internal.Transaction.html#callTX" class="link">Source</a> <a href="#v:callTX" class="selflink">#</a></p><div class="doc"><p>Calls the transaction function, keeping the metadata safe.  Escrows
 are saved in advance and restored before running the fallback function,
 and errors in the call itself or its outputs are deferred to the return
 value.</p></div></div><h2 id="g:5">Running contracts</h2><div class="top"><p class="src"><a id="v:runInputContracts" class="def">runInputContracts</a> :: <a href="Blockchain-Fae-Internal-Transaction.html#t:Inputs">Inputs</a> -&gt; <a href="Blockchain-Fae-Internal-Transaction.html#t:TXStorageM">TXStorageM</a> (<a href="../vector-0.12.0.1/Data-Vector.html#t:Vector">Vector</a> <a href="Blockchain-Fae-Internal-Storage.html#t:InputResults">InputResults</a>) <a href="src/Blockchain.Fae.Internal.Transaction.html#runInputContracts" class="link">Source</a> <a href="#v:runInputContracts" class="selflink">#</a></p><div class="doc"><p>Runs all the input contracts, accumulating a list of results that is
 recursively provided back to each call, so that they can use previously
 returned versioned values.</p></div></div><div class="top"><p class="src"><a id="v:nextInput" class="def">nextInput</a> :: <a href="Blockchain-Fae-Internal-Versions.html#t:InputVersionMap">InputVersionMap</a> -&gt; (<a href="Blockchain-Fae-Internal-IDs-Types.html#t:ContractID">ContractID</a>, <a href="../base-4.10.1.0/Data-String.html#t:String">String</a>, <a href="Blockchain-Fae-Internal-IDs-Types.html#t:Renames">Renames</a>) -&gt; <a href="Blockchain-Fae-Internal-Transaction.html#t:TXStorageM">TXStorageM</a> <a href="Blockchain-Fae-Internal-Storage.html#t:InputResults">InputResults</a> <a href="src/Blockchain.Fae.Internal.Transaction.html#nextInput" class="link">Source</a> <a href="#v:nextInput" class="selflink">#</a></p><div class="doc"><p>Looks up the contract ID and dispatches to the various possible
 actions (call, import, error) depending on what's found.</p></div></div><div class="top"><p class="src"><a id="v:contractCallResult" class="def">contractCallResult</a> :: <a href="Blockchain-Fae-Internal-Versions.html#t:InputVersionMap">InputVersionMap</a> -&gt; <a href="../base-4.10.1.0/Data-String.html#t:String">String</a> -&gt; <a href="Blockchain-Fae-Internal-IDs-Types.html#t:Renames">Renames</a> -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:OutputData">OutputData</a> -&gt; <a href="Blockchain-Fae-Internal-IDs-Types.html#t:ContractID">ContractID</a> -&gt; <a href="Blockchain-Fae-Internal-Transaction.html#t:TXStorageM">TXStorageM</a> <a href="Blockchain-Fae-Internal-Storage.html#t:InputResults">InputResults</a> <a href="src/Blockchain.Fae.Internal.Transaction.html#contractCallResult" class="link">Source</a> <a href="#v:contractCallResult" class="selflink">#</a></p><div class="doc"><p>If the contract function is available, use it, update if it suceeds,
 and produce the results regardless.</p><p>This used to update the nonce in <code><a href="Blockchain-Fae-Internal-Storage.html#v:iRealID">iRealID</a></code> from <code><a href="Blockchain-Fae-Internal-IDs-Types.html#v:Current">Current</a></code> to <code><code><a href="Blockchain-Fae-Internal-IDs-Types.html#t:Nonce">Nonce</a></code>
 n</code>, where <code>n</code> is the actual current nonce.  This allowed exporting and
 then importing return values of <code><a href="Blockchain-Fae-Internal-IDs-Types.html#v:Current">Current</a></code>-called contracts.  However,
 the removal of <code>iVersions</code> made it clear that this is unsatisfactory,
 because a <code><a href="Blockchain-Fae-Internal-IDs-Types.html#v:Current">Current</a></code>-called contract never produces versions, and
 therefore the versions of its exported-imported result cannot be
 verified against the transaction message.</p><p>Even with the nonce, there is no guarantee that the version is ever used
 in the transaction.  This requires future improvements.</p></div></div><div class="top"><p class="src"><a id="v:importedCallResult" class="def">importedCallResult</a> :: <a href="Blockchain-Fae-Internal-Storage.html#t:InputResults">InputResults</a> -&gt; <a href="Blockchain-Fae-Internal-IDs-Types.html#t:ContractID">ContractID</a> -&gt; <a href="Blockchain-Fae-Internal-Transaction.html#t:TXStorageM">TXStorageM</a> <a href="Blockchain-Fae-Internal-Storage.html#t:InputResults">InputResults</a> <a href="src/Blockchain.Fae.Internal.Transaction.html#importedCallResult" class="link">Source</a> <a href="#v:importedCallResult" class="selflink">#</a></p><div class="doc"><p>If instead we have an imported value, just use that.  </p></div></div><div class="top"><p class="src"><a id="v:errInputResult" class="def">errInputResult</a> :: <a href="Blockchain-Fae-Internal-IDs-Types.html#t:ContractID">ContractID</a> -&gt; <a href="Blockchain-Fae-Internal-Transaction.html#t:TXStorageM">TXStorageM</a> <a href="Blockchain-Fae-Internal-Storage.html#t:InputResults">InputResults</a> <a href="src/Blockchain.Fae.Internal.Transaction.html#errInputResult" class="link">Source</a> <a href="#v:errInputResult" class="selflink">#</a></p><div class="doc"><p>Otherwise, this input is exceptional (and so, probably, is the
 transaction result).</p></div></div><div class="top"><p class="src"><a id="v:runContract" class="def">runContract</a> :: <a href="Blockchain-Fae-Internal-IDs-Types.html#t:ContractID">ContractID</a> -&gt; <a href="Blockchain-Fae-Internal-Versions.html#t:InputVersionMap">InputVersionMap</a> -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:AbstractGlobalContract">AbstractGlobalContract</a> -&gt; <a href="../base-4.10.1.0/Data-String.html#t:String">String</a> -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeTXM">FaeTXM</a> (<a href="Blockchain-Fae-Internal-Storage.html#t:InputResults">InputResults</a>, <a href="../base-4.10.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Blockchain-Fae-Internal-Contract.html#t:AbstractGlobalContract">AbstractGlobalContract</a>) <a href="src/Blockchain.Fae.Internal.Transaction.html#runContract" class="link">Source</a> <a href="#v:runContract" class="selflink">#</a></p><div class="doc"><p>Executes the contract function, returning the result and the
 continuation function.  This is where the <code><a href="Blockchain-Fae-Internal-Storage.html#v:iStatus">iStatus</a></code> field of the
 <code><a href="Blockchain-Fae-Internal-Storage.html#t:InputResults">InputResults</a></code> value is set, because this is the last place where the
 <code><a href="../base-4.10.1.0/Data-Maybe.html#t:Maybe">Maybe</a></code> on the continuation is readily available.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.18.1</p></div></body></html>