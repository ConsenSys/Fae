<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Blockchain.Fae.Internal.Contract</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Blockchain-Fae-Internal-Contract.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Blockchain.Fae.Internal.Contract.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">fae-0.9.0.0</p></div><div id="content"><div id="module-header"><table class="info"><tr><th valign="top">Copyright</th><td>(c) Ryan Reich 2017</td></tr><tr><th>License</th><td>MIT</td></tr><tr><th>Maintainer</th><td>ryan.reich@gmail.com</td></tr><tr><th>Stability</th><td>experimental</td></tr><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Blockchain.Fae.Internal.Contract</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Types</a></li><li><a href="#g:2">Type classes</a></li><li><a href="#g:3">Template Haskell</a></li><li><a href="#g:4">Functions</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Everything in Fae is a contract, and this module defines contracts and their construction.</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">data</span> <a href="#t:Escrows">Escrows</a> = <a href="#v:Escrows">Escrows</a> {<ul class="subs"><li><a href="#v:escrowMap">escrowMap</a> :: <a href="Blockchain-Fae-Internal-Contract.html#t:EscrowMap">EscrowMap</a></li><li><a href="#v:nextID">nextID</a> :: <a href="Blockchain-Fae-Internal-IDs.html#t:EntryID">EntryID</a></li></ul>}</li><li class="src short"><span class="keyword">type</span> <a href="#t:EscrowMap">EscrowMap</a> = <a href="../containers-0.5.7.1/Data-Map-Lazy.html#t:Map">Map</a> <a href="Blockchain-Fae-Internal-IDs.html#t:EntryID">EntryID</a> <a href="Blockchain-Fae-Internal-Contract.html#t:AbstractEscrow">AbstractEscrow</a></li><li class="src short"><span class="keyword">data</span> <a href="#t:WithEscrows">WithEscrows</a> a = <a href="#v:WithEscrows">WithEscrows</a> <a href="Blockchain-Fae-Internal-Contract.html#t:EscrowMap">EscrowMap</a> a</li><li class="src short"><span class="keyword">type</span> <a href="#t:FaeRequest">FaeRequest</a> argType valType = <a href="../monad-coroutine-0.9.0.3/Control-Monad-Coroutine-SuspensionFunctors.html#t:Request">Request</a> (<a href="Blockchain-Fae-Internal-Contract.html#t:WithEscrows">WithEscrows</a> valType) (<a href="Blockchain-Fae-Internal-Contract.html#t:WithEscrows">WithEscrows</a> argType)</li><li class="src short"><span class="keyword">type</span> <a href="#t:FaeRW">FaeRW</a> = <a href="../mtl-2.2.1/Control-Monad-Writer-Lazy.html#t:WriterT">WriterT</a> [<a href="Blockchain-Fae-Internal-Contract.html#t:AbstractContract">AbstractContract</a>] (<a href="../mtl-2.2.1/Control-Monad-Reader.html#t:Reader">Reader</a> <a href="Blockchain-Fae-Internal-Crypto.html#t:PublicKey">PublicKey</a>)</li><li class="src short"><span class="keyword">type</span> <a href="#t:FaeContract">FaeContract</a> s = <a href="../monad-coroutine-0.9.0.3/Control-Monad-Coroutine.html#t:Coroutine">Coroutine</a> s (<a href="../mtl-2.2.1/Control-Monad-State-Lazy.html#t:StateT">StateT</a> <a href="Blockchain-Fae-Internal-Contract.html#t:Escrows">Escrows</a> <a href="Blockchain-Fae-Internal-Contract.html#t:FaeRW">FaeRW</a>)</li><li class="src short"><span class="keyword">newtype</span> <a href="#t:FaeM">FaeM</a> s a = <a href="#v:Fae">Fae</a> {<ul class="subs"><li><a href="#v:getFae">getFae</a> :: <a href="Blockchain-Fae-Internal-Contract.html#t:FaeContract">FaeContract</a> s a</li></ul>}</li><li class="src short"><span class="keyword">type</span> <a href="#t:Fae">Fae</a> argType valType = <a href="Blockchain-Fae-Internal-Contract.html#t:FaeM">FaeM</a> (<a href="Blockchain-Fae-Internal-Contract.html#t:FaeRequest">FaeRequest</a> argType valType)</li><li class="src short"><span class="keyword">type</span> <a href="#t:FaeTX">FaeTX</a> = <a href="Blockchain-Fae-Internal-Contract.html#t:FaeM">FaeM</a> <a href="../monad-coroutine-0.9.0.3/Control-Monad-Coroutine.html#t:Naught">Naught</a></li><li class="src short"><span class="keyword">type</span> <a href="#t:ContractT">ContractT</a> m argType valType = argType -&gt; m (<a href="Blockchain-Fae-Internal-Contract.html#t:WithEscrows">WithEscrows</a> valType)</li><li class="src short"><span class="keyword">type</span> <a href="#t:Contract">Contract</a> argType valType = <a href="Blockchain-Fae-Internal-Contract.html#t:ContractT">ContractT</a> (<a href="Blockchain-Fae-Internal-Contract.html#t:Fae">Fae</a> argType valType) argType valType</li><li class="src short"><span class="keyword">type</span> <a href="#t:InternalT">InternalT</a> s argType valType = <a href="Blockchain-Fae-Internal-Contract.html#t:ContractT">ContractT</a> (<a href="../monad-coroutine-0.9.0.3/Control-Monad-Coroutine.html#t:Coroutine">Coroutine</a> s <a href="Blockchain-Fae-Internal-Contract.html#t:FaeRW">FaeRW</a>) argType valType</li><li class="src short"><span class="keyword">type</span> <a href="#t:InternalContract">InternalContract</a> argType valType = <a href="Blockchain-Fae-Internal-Contract.html#t:InternalT">InternalT</a> (<a href="Blockchain-Fae-Internal-Contract.html#t:FaeRequest">FaeRequest</a> argType valType) (<a href="Blockchain-Fae-Internal-Contract.html#t:WithEscrows">WithEscrows</a> argType) valType</li><li class="src short"><span class="keyword">newtype</span> <a href="#t:ConcreteContract">ConcreteContract</a> argType valType = <a href="#v:ConcreteContract">ConcreteContract</a> (<span class="keyword">forall</span> s. <a href="../base-4.9.1.0/Data-Functor.html#t:Functor">Functor</a> s =&gt; argType -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeContract">FaeContract</a> s (<a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> (<a href="Blockchain-Fae-Internal-Contract.html#t:ConcreteContract">ConcreteContract</a> argType valType), valType))</li><li class="src short"><span class="keyword">type</span> <a href="#t:AbstractEscrow">AbstractEscrow</a> = <a href="Blockchain-Fae-Internal-Contract.html#t:ConcreteContract">ConcreteContract</a> <a href="../base-4.9.1.0/Data-Dynamic.html#t:Dynamic">Dynamic</a> <a href="../base-4.9.1.0/Data-Dynamic.html#t:Dynamic">Dynamic</a></li><li class="src short"><span class="keyword">type</span> <a href="#t:AbstractContract">AbstractContract</a> = <a href="Blockchain-Fae-Internal-Contract.html#t:ConcreteContract">ConcreteContract</a> <a href="Blockchain-Fae-Internal-Contract.html#t:Input">Input</a> <a href="../base-4.9.1.0/Data-Dynamic.html#t:Dynamic">Dynamic</a></li><li class="src short"><span class="keyword">data</span> <a href="#t:ContractException">ContractException</a><ul class="subs"><li>= <a href="#v:BadInputParse">BadInputParse</a> <a href="../base-4.9.1.0/Data-String.html#t:String">String</a> <a href="../base-4.9.1.0/Data-Typeable-Internal.html#t:TypeRep">TypeRep</a></li><li>| <a href="#v:BadArgType">BadArgType</a> <a href="../base-4.9.1.0/Data-Typeable-Internal.html#t:TypeRep">TypeRep</a> <a href="../base-4.9.1.0/Data-Typeable-Internal.html#t:TypeRep">TypeRep</a></li><li>| <a href="#v:BadValType">BadValType</a> <a href="../base-4.9.1.0/Data-Typeable-Internal.html#t:TypeRep">TypeRep</a> <a href="../base-4.9.1.0/Data-Typeable-Internal.html#t:TypeRep">TypeRep</a></li><li>| <a href="#v:BadEscrowID">BadEscrowID</a> <a href="Blockchain-Fae-Internal-IDs.html#t:EntryID">EntryID</a></li></ul></li><li class="src short"><span class="keyword">data</span> <a href="#t:Input">Input</a> = <a href="Blockchain-Fae-Internal-IDs.html#t:HasEscrowIDs">HasEscrowIDs</a> a =&gt; <a href="#v:Input">Input</a> a <a href="../base-4.9.1.0/Data-String.html#t:String">String</a></li><li class="src short"><span class="keyword">class</span> <a href="#t:ReadInput">ReadInput</a> a <span class="keyword">where</span><ul class="subs"></ul></li><li class="src short"><a href="#v:_nextID">_nextID</a> :: <a href="../lens-4.15.4/Control-Lens-Type.html#t:Lens-39-">Lens'</a> <a href="Blockchain-Fae-Internal-Contract.html#t:Escrows">Escrows</a> <a href="Blockchain-Fae-Internal-IDs.html#t:EntryID">EntryID</a></li><li class="src short"><a href="#v:_escrowMap">_escrowMap</a> :: <a href="../lens-4.15.4/Control-Lens-Type.html#t:Lens-39-">Lens'</a> <a href="Blockchain-Fae-Internal-Contract.html#t:Escrows">Escrows</a> <a href="Blockchain-Fae-Internal-Contract.html#t:EscrowMap">EscrowMap</a></li><li class="src short"><a href="#v:makeEscrow">makeEscrow</a> :: (<a href="Blockchain-Fae-Internal-IDs.html#t:HasEscrowIDs">HasEscrowIDs</a> argType, <a href="Blockchain-Fae-Internal-IDs.html#t:HasEscrowIDs">HasEscrowIDs</a> valType, <a href="Blockchain-Fae-Internal-Exceptions.html#t:Typeable">Typeable</a> argType, <a href="Blockchain-Fae-Internal-Exceptions.html#t:Typeable">Typeable</a> valType, <a href="Blockchain-Fae.html#t:NFData">NFData</a> argType, <a href="../base-4.9.1.0/Data-Functor.html#t:Functor">Functor</a> s) =&gt; [<a href="Blockchain-Fae-Internal-IDs.html#t:BearsValue">BearsValue</a>] -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:Contract">Contract</a> argType valType -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeContract">FaeContract</a> s <a href="Blockchain-Fae-Internal-Contract.html#t:AbstractEscrow">AbstractEscrow</a></li><li class="src short"><a href="#v:makeContract">makeContract</a> :: (<a href="Blockchain-Fae-Internal-IDs.html#t:HasEscrowIDs">HasEscrowIDs</a> argType, <a href="Blockchain-Fae-Internal-IDs.html#t:HasEscrowIDs">HasEscrowIDs</a> valType, <a href="Blockchain-Fae-Internal-Contract.html#t:ReadInput">ReadInput</a> argType, <a href="Blockchain-Fae-Internal-Exceptions.html#t:Typeable">Typeable</a> argType, <a href="Blockchain-Fae-Internal-Exceptions.html#t:Typeable">Typeable</a> valType, <a href="../base-4.9.1.0/Data-Functor.html#t:Functor">Functor</a> s) =&gt; [<a href="Blockchain-Fae-Internal-IDs.html#t:BearsValue">BearsValue</a>] -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:Contract">Contract</a> argType valType -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeContract">FaeContract</a> s <a href="Blockchain-Fae-Internal-Contract.html#t:AbstractContract">AbstractContract</a></li><li class="src short"><a href="#v:makeInternalT">makeInternalT</a> :: (<a href="../base-4.9.1.0/Data-Functor.html#t:Functor">Functor</a> s, <a href="../base-4.9.1.0/Data-Functor.html#t:Functor">Functor</a> s') =&gt; [<a href="Blockchain-Fae-Internal-IDs.html#t:BearsValue">BearsValue</a>] -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:ContractT">ContractT</a> (<a href="Blockchain-Fae-Internal-Contract.html#t:FaeContract">FaeContract</a> s') argType valType -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeContract">FaeContract</a> s (<a href="Blockchain-Fae-Internal-Contract.html#t:InternalT">InternalT</a> s' (<a href="Blockchain-Fae-Internal-Contract.html#t:WithEscrows">WithEscrows</a> argType) valType)</li><li class="src short"><a href="#v:makeEscrowConcrete">makeEscrowConcrete</a> :: (<a href="Blockchain-Fae-Internal-IDs.html#t:HasEscrowIDs">HasEscrowIDs</a> argType, <a href="Blockchain-Fae-Internal-IDs.html#t:HasEscrowIDs">HasEscrowIDs</a> valType, <a href="Blockchain-Fae.html#t:NFData">NFData</a> argType) =&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:InternalContract">InternalContract</a> argType valType -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:ConcreteContract">ConcreteContract</a> argType valType</li><li class="src short"><a href="#v:makeContractConcrete">makeContractConcrete</a> :: (<a href="Blockchain-Fae-Internal-IDs.html#t:HasEscrowIDs">HasEscrowIDs</a> argType, <a href="Blockchain-Fae-Internal-IDs.html#t:HasEscrowIDs">HasEscrowIDs</a> valType) =&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:InternalContract">InternalContract</a> argType valType -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:ConcreteContract">ConcreteContract</a> argType valType</li><li class="src short"><a href="#v:makeConcrete">makeConcrete</a> :: (<a href="Blockchain-Fae-Internal-IDs.html#t:HasEscrowIDs">HasEscrowIDs</a> argType, <a href="Blockchain-Fae-Internal-IDs.html#t:HasEscrowIDs">HasEscrowIDs</a> valType) =&gt; (<span class="keyword">forall</span> s. <a href="../base-4.9.1.0/Data-Functor.html#t:Functor">Functor</a> s =&gt; argType -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeContract">FaeContract</a> s (<a href="Blockchain-Fae-Internal-Contract.html#t:WithEscrows">WithEscrows</a> argType)) -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:InternalContract">InternalContract</a> argType valType -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:ConcreteContract">ConcreteContract</a> argType valType</li><li class="src short"><a href="#v:makeEscrowAbstract">makeEscrowAbstract</a> :: <span class="keyword">forall</span> argType valType. (<a href="Blockchain-Fae-Internal-Exceptions.html#t:Typeable">Typeable</a> argType, <a href="Blockchain-Fae-Internal-Exceptions.html#t:Typeable">Typeable</a> valType) =&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:ConcreteContract">ConcreteContract</a> argType valType -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:AbstractEscrow">AbstractEscrow</a></li><li class="src short"><a href="#v:makeContractAbstract">makeContractAbstract</a> :: <span class="keyword">forall</span> argType valType. (<a href="Blockchain-Fae-Internal-Contract.html#t:ReadInput">ReadInput</a> argType, <a href="Blockchain-Fae-Internal-Exceptions.html#t:Typeable">Typeable</a> argType, <a href="Blockchain-Fae-Internal-Exceptions.html#t:Typeable">Typeable</a> valType) =&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:ConcreteContract">ConcreteContract</a> argType valType -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:AbstractContract">AbstractContract</a></li><li class="src short"><a href="#v:unmakeAbstractEscrow">unmakeAbstractEscrow</a> :: <span class="keyword">forall</span> argType valType. (<a href="Blockchain-Fae-Internal-Exceptions.html#t:Typeable">Typeable</a> argType, <a href="Blockchain-Fae-Internal-Exceptions.html#t:Typeable">Typeable</a> valType) =&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:AbstractEscrow">AbstractEscrow</a> -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:ConcreteContract">ConcreteContract</a> argType valType</li><li class="src short"><a href="#v:takeEscrows">takeEscrows</a> :: <a href="../adjunctions-4.3/Control-Monad-Representable-State.html#t:MonadState">MonadState</a> <a href="Blockchain-Fae-Internal-Contract.html#t:Escrows">Escrows</a> m =&gt; [<a href="Blockchain-Fae-Internal-IDs.html#t:BearsValue">BearsValue</a>] -&gt; m <a href="Blockchain-Fae-Internal-Contract.html#t:Escrows">Escrows</a></li><li class="src short"><a href="#v:getEscrowMap">getEscrowMap</a> :: <span class="keyword">forall</span> m. <a href="../adjunctions-4.3/Control-Monad-Representable-State.html#t:MonadState">MonadState</a> <a href="Blockchain-Fae-Internal-Contract.html#t:Escrows">Escrows</a> m =&gt; [<a href="Blockchain-Fae-Internal-IDs.html#t:BearsValue">BearsValue</a>] -&gt; m <a href="Blockchain-Fae-Internal-Contract.html#t:EscrowMap">EscrowMap</a></li><li class="src short"><a href="#v:takeEscrow">takeEscrow</a> :: <a href="../adjunctions-4.3/Control-Monad-Representable-State.html#t:MonadState">MonadState</a> <a href="Blockchain-Fae-Internal-Contract.html#t:Escrows">Escrows</a> m =&gt; <a href="Blockchain-Fae-Internal-IDs.html#t:EscrowID">EscrowID</a> argType valType -&gt; m (<a href="Blockchain-Fae-Internal-IDs.html#t:EntryID">EntryID</a>, <a href="Blockchain-Fae-Internal-Contract.html#t:AbstractEscrow">AbstractEscrow</a>)</li><li class="src short"><a href="#v:internalSpend">internalSpend</a> :: (<a href="Blockchain-Fae-Internal-IDs.html#t:HasEscrowIDs">HasEscrowIDs</a> valType, <a href="../adjunctions-4.3/Control-Monad-Representable-State.html#t:MonadState">MonadState</a> <a href="Blockchain-Fae-Internal-Contract.html#t:Escrows">Escrows</a> m, <a href="Blockchain-Fae.html#t:NFData">NFData</a> valType) =&gt; valType -&gt; m (<a href="Blockchain-Fae-Internal-Contract.html#t:WithEscrows">WithEscrows</a> valType)</li><li class="src short"><a href="#v:internalUseEscrow">internalUseEscrow</a> :: (<a href="Blockchain-Fae-Internal-IDs.html#t:HasEscrowIDs">HasEscrowIDs</a> argType, <a href="Blockchain-Fae-Internal-IDs.html#t:HasEscrowIDs">HasEscrowIDs</a> valType, <a href="Blockchain-Fae-Internal-Exceptions.html#t:Typeable">Typeable</a> argType, <a href="Blockchain-Fae-Internal-Exceptions.html#t:Typeable">Typeable</a> valType, <a href="../base-4.9.1.0/Data-Functor.html#t:Functor">Functor</a> s) =&gt; <a href="Blockchain-Fae-Internal-IDs.html#t:EntryID">EntryID</a> -&gt; argType -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeContract">FaeContract</a> s valType</li><li class="src short"><a href="#v:runTXEscrows">runTXEscrows</a> :: <span class="keyword">forall</span> a s. (<a href="Blockchain-Fae-Internal-IDs.html#t:HasEscrowIDs">HasEscrowIDs</a> a, <a href="../base-4.9.1.0/Data-Functor.html#t:Functor">Functor</a> s) =&gt; a -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeContract">FaeContract</a> s a</li></ul></div><div id="interface"><h1 id="g:1">Types</h1><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Escrows" class="def">Escrows</a> <a href="src/Blockchain.Fae.Internal.Contract.html#Escrows" class="link">Source</a> <a href="#t:Escrows" class="selflink">#</a></p><div class="doc"><p>How escrows are kept in each contract.  Contracts track their escrow
 ID sequence separately to prevent coupling between different ones.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:Escrows" class="def">Escrows</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:escrowMap" class="def">escrowMap</a> :: <a href="Blockchain-Fae-Internal-Contract.html#t:EscrowMap">EscrowMap</a></dfn><div class="doc empty">&nbsp;</div></li><li><dfn class="src"><a id="v:nextID" class="def">nextID</a> :: <a href="Blockchain-Fae-Internal-IDs.html#t:EntryID">EntryID</a></dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div><div class="subs instances"><p id="control.i:Escrows" class="caption collapser" onclick="toggleSection('i:Escrows')">Instances</p><div id="section.i:Escrows" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:Escrows:Generic:1" class="instance expander" onclick="toggleSection('i:id:Escrows:Generic:1')"></span> <a href="Blockchain-Fae.html#t:Generic">Generic</a> <a href="Blockchain-Fae-Internal-Contract.html#t:Escrows">Escrows</a></span> <a href="src/Blockchain.Fae.Internal.Contract.html#line-45" class="link">Source</a> <a href="#t:Escrows" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:id:Escrows:Generic:1" class="inst-details hide"><div class="subs associated-types"><p class="caption">Associated Types</p><p class="src"><span class="keyword">type</span> <a href="../base-4.9.1.0/GHC-Generics.html#t:Rep">Rep</a> <a href="Blockchain-Fae-Internal-Contract.html#t:Escrows">Escrows</a> :: <a href="../base-4.9.1.0/Data-Kind.html#t:-42-">*</a> -&gt; <a href="../base-4.9.1.0/Data-Kind.html#t:-42-">*</a> <a href="#t:Rep" class="selflink">#</a></p></div> <div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:from">from</a> :: <a href="Blockchain-Fae-Internal-Contract.html#t:Escrows">Escrows</a> -&gt; <a href="../base-4.9.1.0/GHC-Generics.html#t:Rep">Rep</a> <a href="Blockchain-Fae-Internal-Contract.html#t:Escrows">Escrows</a> x <a href="#v:from" class="selflink">#</a></p><p class="src"><a href="#v:to">to</a> :: <a href="../base-4.9.1.0/GHC-Generics.html#t:Rep">Rep</a> <a href="Blockchain-Fae-Internal-Contract.html#t:Escrows">Escrows</a> x -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:Escrows">Escrows</a> <a href="#v:to" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:Escrows:NFData:2" class="instance expander" onclick="toggleSection('i:id:Escrows:NFData:2')"></span> <a href="Blockchain-Fae.html#t:NFData">NFData</a> <a href="Blockchain-Fae-Internal-Contract.html#t:Escrows">Escrows</a></span> <a href="src/Blockchain.Fae.Internal.Contract.html#line-156" class="link">Source</a> <a href="#t:Escrows" class="selflink">#</a></td><td class="doc"><p>So that we can force escrows as they are returned from contracts.
 This is necessary to prevent malicious actors from embedding
 a non-terminating transaction that a recipient will have to execute.</p></td></tr><tr><td colspan="2"><div id="section.i:id:Escrows:NFData:2" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:rnf">rnf</a> :: <a href="Blockchain-Fae-Internal-Contract.html#t:Escrows">Escrows</a> -&gt; () <a href="#v:rnf" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:Escrows:MonadTX:3" class="instance expander" onclick="toggleSection('i:id:Escrows:MonadTX:3')"></span> <a href="../base-4.9.1.0/Data-Functor.html#t:Functor">Functor</a> s =&gt; <a href="Blockchain-Fae-Internal-MonadFae.html#t:MonadTX">MonadTX</a> (<a href="Blockchain-Fae-Internal-Contract.html#t:FaeContract">FaeContract</a> s)</span> <a href="src/Blockchain.Fae.Internal.MonadFae.html#line-87" class="link">Source</a> <a href="#t:MonadTX" class="selflink">#</a></td><td class="doc"><p>A little backwards, since <code><a href="Blockchain-Fae-Internal-Contract.html#t:FaeContract">FaeContract</a></code> lies below rather than above
 <code><a href="Blockchain-Fae-Internal-Contract.html#t:FaeTX">FaeTX</a></code>, but they are actually isomorphic, and we need to start the
 monad stack down here so that we can derive <code>forall s. (Functor s) =&gt;
 MonadTX (FaeM s)</code>. </p></td></tr><tr><td colspan="2"><div id="section.i:id:Escrows:MonadTX:3" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:liftTX">liftTX</a> :: <a href="Blockchain-Fae-Internal-Contract.html#t:FaeTX">FaeTX</a> a -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeContract">FaeContract</a> s a <a href="src/Blockchain.Fae.Internal.MonadFae.html#liftTX" class="link">Source</a> <a href="#v:liftTX" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:Escrows:Rep:4" class="instance expander" onclick="toggleSection('i:id:Escrows:Rep:4')"></span> <span class="keyword">type</span> <a href="../base-4.9.1.0/GHC-Generics.html#t:Rep">Rep</a> <a href="Blockchain-Fae-Internal-Contract.html#t:Escrows">Escrows</a></span> <a href="src/Blockchain.Fae.Internal.Contract.html#line-40" class="link">Source</a> <a href="#t:Escrows" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:id:Escrows:Rep:4" class="inst-details hide"><div class="src"><span class="keyword">type</span> <a href="../base-4.9.1.0/GHC-Generics.html#t:Rep">Rep</a> <a href="Blockchain-Fae-Internal-Contract.html#t:Escrows">Escrows</a> = <a href="../base-4.9.1.0/GHC-Generics.html#t:D1">D1</a> (<a href="../base-4.9.1.0/GHC-Generics.html#v:MetaData">MetaData</a> &quot;Escrows&quot; &quot;Blockchain.Fae.Internal.Contract&quot; &quot;fae-0.9.0.0-5b8Joj7e0DOwNmonXcml8&quot; <a href="../base-4.9.1.0/Data-Bool.html#v:False">False</a>) (<a href="../base-4.9.1.0/GHC-Generics.html#t:C1">C1</a> (<a href="../base-4.9.1.0/GHC-Generics.html#v:MetaCons">MetaCons</a> &quot;Escrows&quot; <a href="../base-4.9.1.0/GHC-Generics.html#v:PrefixI">PrefixI</a> <a href="../base-4.9.1.0/Data-Bool.html#v:True">True</a>) (<a href="../base-4.9.1.0/GHC-Generics.html#t::-42-:">(:*:)</a> (<a href="../base-4.9.1.0/GHC-Generics.html#t:S1">S1</a> (<a href="../base-4.9.1.0/GHC-Generics.html#v:MetaSel">MetaSel</a> (<a href="../base-4.9.1.0/Data-Maybe.html#v:Just">Just</a> <a href="../base-4.9.1.0/GHC-TypeLits.html#t:Symbol">Symbol</a> &quot;escrowMap&quot;) <a href="../base-4.9.1.0/GHC-Generics.html#v:NoSourceUnpackedness">NoSourceUnpackedness</a> <a href="../base-4.9.1.0/GHC-Generics.html#v:NoSourceStrictness">NoSourceStrictness</a> <a href="../base-4.9.1.0/GHC-Generics.html#v:DecidedLazy">DecidedLazy</a>) (<a href="../base-4.9.1.0/GHC-Generics.html#t:Rec0">Rec0</a> <a href="Blockchain-Fae-Internal-Contract.html#t:EscrowMap">EscrowMap</a>)) (<a href="../base-4.9.1.0/GHC-Generics.html#t:S1">S1</a> (<a href="../base-4.9.1.0/GHC-Generics.html#v:MetaSel">MetaSel</a> (<a href="../base-4.9.1.0/Data-Maybe.html#v:Just">Just</a> <a href="../base-4.9.1.0/GHC-TypeLits.html#t:Symbol">Symbol</a> &quot;nextID&quot;) <a href="../base-4.9.1.0/GHC-Generics.html#v:NoSourceUnpackedness">NoSourceUnpackedness</a> <a href="../base-4.9.1.0/GHC-Generics.html#v:NoSourceStrictness">NoSourceStrictness</a> <a href="../base-4.9.1.0/GHC-Generics.html#v:DecidedLazy">DecidedLazy</a>) (<a href="../base-4.9.1.0/GHC-Generics.html#t:Rec0">Rec0</a> <a href="Blockchain-Fae-Internal-IDs.html#t:EntryID">EntryID</a>))))</div></div></td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:EscrowMap" class="def">EscrowMap</a> = <a href="../containers-0.5.7.1/Data-Map-Lazy.html#t:Map">Map</a> <a href="Blockchain-Fae-Internal-IDs.html#t:EntryID">EntryID</a> <a href="Blockchain-Fae-Internal-Contract.html#t:AbstractEscrow">AbstractEscrow</a> <a href="src/Blockchain.Fae.Internal.Contract.html#EscrowMap" class="link">Source</a> <a href="#t:EscrowMap" class="selflink">#</a></p><div class="doc"><p>Convenience type</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:WithEscrows" class="def">WithEscrows</a> a <a href="src/Blockchain.Fae.Internal.Contract.html#WithEscrows" class="link">Source</a> <a href="#t:WithEscrows" class="selflink">#</a></p><div class="doc"><p>This type encodes a value together with its backing escrows.  It is
 constructed automatically, and you can't construct it manually, so it is
 only useful in type signatures; it forces contracts to return values
 only via <code>spend</code> and <code>release</code>.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:WithEscrows" class="def">WithEscrows</a> <a href="Blockchain-Fae-Internal-Contract.html#t:EscrowMap">EscrowMap</a> a</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><p id="control.i:WithEscrows" class="caption collapser" onclick="toggleSection('i:WithEscrows')">Instances</p><div id="section.i:WithEscrows" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:WithEscrows:MonadContract:1" class="instance expander" onclick="toggleSection('i:id:WithEscrows:MonadContract:1')"></span> (<a href="Blockchain-Fae-Internal-IDs.html#t:HasEscrowIDs">HasEscrowIDs</a> argType, <a href="Blockchain-Fae-Internal-IDs.html#t:HasEscrowIDs">HasEscrowIDs</a> valType) =&gt; <a href="Blockchain-Fae-Internal-MonadFae.html#t:MonadContract">MonadContract</a> argType valType (<a href="Blockchain-Fae-Internal-Contract.html#t:Fae">Fae</a> argType valType)</span> <a href="src/Blockchain.Fae.Internal.MonadFae.html#line-78" class="link">Source</a> <a href="#t:MonadContract" class="selflink">#</a></td><td class="doc"><p>Of course</p></td></tr><tr><td colspan="2"><div id="section.i:id:WithEscrows:MonadContract:1" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:liftContract">liftContract</a> :: <a href="Blockchain-Fae-Internal-Contract.html#t:Fae">Fae</a> argType valType a -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:Fae">Fae</a> argType valType a <a href="src/Blockchain.Fae.Internal.MonadFae.html#liftContract" class="link">Source</a> <a href="#v:liftContract" class="selflink">#</a></p></div></div></td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:FaeRequest" class="def">FaeRequest</a> argType valType = <a href="../monad-coroutine-0.9.0.3/Control-Monad-Coroutine-SuspensionFunctors.html#t:Request">Request</a> (<a href="Blockchain-Fae-Internal-Contract.html#t:WithEscrows">WithEscrows</a> valType) (<a href="Blockchain-Fae-Internal-Contract.html#t:WithEscrows">WithEscrows</a> argType) <a href="src/Blockchain.Fae.Internal.Contract.html#FaeRequest" class="link">Source</a> <a href="#t:FaeRequest" class="selflink">#</a></p><div class="doc"><p>The <code><a href="../monad-coroutine-0.9.0.3/Control-Monad-Coroutine-SuspensionFunctors.html#t:Request">Request</a></code> type is backwards for my visualization of contracts as
 coroutines, and also needs to be augmented with backing escrows.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:FaeRW" class="def">FaeRW</a> = <a href="../mtl-2.2.1/Control-Monad-Writer-Lazy.html#t:WriterT">WriterT</a> [<a href="Blockchain-Fae-Internal-Contract.html#t:AbstractContract">AbstractContract</a>] (<a href="../mtl-2.2.1/Control-Monad-Reader.html#t:Reader">Reader</a> <a href="Blockchain-Fae-Internal-Crypto.html#t:PublicKey">PublicKey</a>) <a href="src/Blockchain.Fae.Internal.Contract.html#FaeRW" class="link">Source</a> <a href="#t:FaeRW" class="selflink">#</a></p><div class="doc"><p>This monad contains everything that relates a contract to its
 surrounding transaction.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:FaeContract" class="def">FaeContract</a> s = <a href="../monad-coroutine-0.9.0.3/Control-Monad-Coroutine.html#t:Coroutine">Coroutine</a> s (<a href="../mtl-2.2.1/Control-Monad-State-Lazy.html#t:StateT">StateT</a> <a href="Blockchain-Fae-Internal-Contract.html#t:Escrows">Escrows</a> <a href="Blockchain-Fae-Internal-Contract.html#t:FaeRW">FaeRW</a>) <a href="src/Blockchain.Fae.Internal.Contract.html#FaeContract" class="link">Source</a> <a href="#t:FaeContract" class="selflink">#</a></p><div class="doc"><p>The actual contract monad builds on <code><a href="Blockchain-Fae-Internal-Contract.html#t:FaeRW">FaeRW</a></code> by adding escrows and
 continuation support.</p></div></div><div class="top"><p class="src"><span class="keyword">newtype</span> <a id="t:FaeM" class="def">FaeM</a> s a <a href="src/Blockchain.Fae.Internal.Contract.html#FaeM" class="link">Source</a> <a href="#t:FaeM" class="selflink">#</a></p><div class="doc"><p>This wrapper is necessary because <code><a href="Blockchain-Fae-Internal-Contract.html#t:Fae">Fae</a></code> and <code><a href="Blockchain-Fae-Internal-Contract.html#t:FaeTX">FaeTX</a></code> are monads that
 contract authors can actually use, and so we need to carefully limit the
 capabilities they are allowed.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:Fae" class="def">Fae</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:getFae" class="def">getFae</a> :: <a href="Blockchain-Fae-Internal-Contract.html#t:FaeContract">FaeContract</a> s a</dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div><div class="subs instances"><p id="control.i:FaeM" class="caption collapser" onclick="toggleSection('i:FaeM')">Instances</p><div id="section.i:FaeM" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:FaeM:MonadContract:1" class="instance expander" onclick="toggleSection('i:id:FaeM:MonadContract:1')"></span> (<a href="Blockchain-Fae-Internal-IDs.html#t:HasEscrowIDs">HasEscrowIDs</a> argType, <a href="Blockchain-Fae-Internal-IDs.html#t:HasEscrowIDs">HasEscrowIDs</a> valType) =&gt; <a href="Blockchain-Fae-Internal-MonadFae.html#t:MonadContract">MonadContract</a> argType valType (<a href="Blockchain-Fae-Internal-Contract.html#t:Fae">Fae</a> argType valType)</span> <a href="src/Blockchain.Fae.Internal.MonadFae.html#line-78" class="link">Source</a> <a href="#t:MonadContract" class="selflink">#</a></td><td class="doc"><p>Of course</p></td></tr><tr><td colspan="2"><div id="section.i:id:FaeM:MonadContract:1" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:liftContract">liftContract</a> :: <a href="Blockchain-Fae-Internal-Contract.html#t:Fae">Fae</a> argType valType a -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:Fae">Fae</a> argType valType a <a href="src/Blockchain.Fae.Internal.MonadFae.html#liftContract" class="link">Source</a> <a href="#v:liftContract" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:FaeM:Monad:2" class="instance expander" onclick="toggleSection('i:id:FaeM:Monad:2')"></span> <a href="../base-4.9.1.0/Data-Functor.html#t:Functor">Functor</a> s =&gt; <a href="../base-4.9.1.0/Control-Monad.html#t:Monad">Monad</a> (<a href="Blockchain-Fae-Internal-Contract.html#t:FaeM">FaeM</a> s)</span> <a href="src/Blockchain.Fae.Internal.Contract.html#line-69" class="link">Source</a> <a href="#t:FaeM" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:id:FaeM:Monad:2" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:-62--62--61-">(&gt;&gt;=)</a> :: <a href="Blockchain-Fae-Internal-Contract.html#t:FaeM">FaeM</a> s a -&gt; (a -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeM">FaeM</a> s b) -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeM">FaeM</a> s b <a href="#v:-62--62--61-" class="selflink">#</a></p><p class="src"><a href="#v:-62--62-">(&gt;&gt;)</a> :: <a href="Blockchain-Fae-Internal-Contract.html#t:FaeM">FaeM</a> s a -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeM">FaeM</a> s b -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeM">FaeM</a> s b <a href="#v:-62--62-" class="selflink">#</a></p><p class="src"><a href="#v:return">return</a> :: a -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeM">FaeM</a> s a <a href="#v:return" class="selflink">#</a></p><p class="src"><a href="#v:fail">fail</a> :: <a href="../base-4.9.1.0/Data-String.html#t:String">String</a> -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeM">FaeM</a> s a <a href="#v:fail" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:FaeM:Functor:3" class="instance expander" onclick="toggleSection('i:id:FaeM:Functor:3')"></span> <a href="../base-4.9.1.0/Data-Functor.html#t:Functor">Functor</a> s =&gt; <a href="../base-4.9.1.0/Data-Functor.html#t:Functor">Functor</a> (<a href="Blockchain-Fae-Internal-Contract.html#t:FaeM">FaeM</a> s)</span> <a href="src/Blockchain.Fae.Internal.Contract.html#line-69" class="link">Source</a> <a href="#t:FaeM" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:id:FaeM:Functor:3" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:fmap">fmap</a> :: (a -&gt; b) -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeM">FaeM</a> s a -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeM">FaeM</a> s b <a href="#v:fmap" class="selflink">#</a></p><p class="src"><a href="#v:-60--36-">(&lt;$)</a> :: a -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeM">FaeM</a> s b -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeM">FaeM</a> s a <a href="#v:-60--36-" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:FaeM:Applicative:4" class="instance expander" onclick="toggleSection('i:id:FaeM:Applicative:4')"></span> <a href="../base-4.9.1.0/Data-Functor.html#t:Functor">Functor</a> s =&gt; <a href="../base-4.9.1.0/Control-Applicative.html#t:Applicative">Applicative</a> (<a href="Blockchain-Fae-Internal-Contract.html#t:FaeM">FaeM</a> s)</span> <a href="src/Blockchain.Fae.Internal.Contract.html#line-69" class="link">Source</a> <a href="#t:FaeM" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:id:FaeM:Applicative:4" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:pure">pure</a> :: a -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeM">FaeM</a> s a <a href="#v:pure" class="selflink">#</a></p><p class="src"><a href="#v:-60--42--62-">(&lt;*&gt;)</a> :: <a href="Blockchain-Fae-Internal-Contract.html#t:FaeM">FaeM</a> s (a -&gt; b) -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeM">FaeM</a> s a -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeM">FaeM</a> s b <a href="#v:-60--42--62-" class="selflink">#</a></p><p class="src"><a href="#v:-42--62-">(*&gt;)</a> :: <a href="Blockchain-Fae-Internal-Contract.html#t:FaeM">FaeM</a> s a -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeM">FaeM</a> s b -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeM">FaeM</a> s b <a href="#v:-42--62-" class="selflink">#</a></p><p class="src"><a href="#v:-60--42-">(&lt;*)</a> :: <a href="Blockchain-Fae-Internal-Contract.html#t:FaeM">FaeM</a> s a -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeM">FaeM</a> s b -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeM">FaeM</a> s a <a href="#v:-60--42-" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:FaeM:MonadTX:5" class="instance expander" onclick="toggleSection('i:id:FaeM:MonadTX:5')"></span> <a href="../base-4.9.1.0/Data-Functor.html#t:Functor">Functor</a> s =&gt; <a href="Blockchain-Fae-Internal-MonadFae.html#t:MonadTX">MonadTX</a> (<a href="Blockchain-Fae-Internal-Contract.html#t:FaeM">FaeM</a> s)</span> <a href="src/Blockchain.Fae.Internal.MonadFae.html#line-91" class="link">Source</a> <a href="#t:MonadTX" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:id:FaeM:MonadTX:5" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:liftTX">liftTX</a> :: <a href="Blockchain-Fae-Internal-Contract.html#t:FaeTX">FaeTX</a> a -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeM">FaeM</a> s a <a href="src/Blockchain.Fae.Internal.MonadFae.html#liftTX" class="link">Source</a> <a href="#v:liftTX" class="selflink">#</a></p></div></div></td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:Fae" class="def">Fae</a> argType valType = <a href="Blockchain-Fae-Internal-Contract.html#t:FaeM">FaeM</a> (<a href="Blockchain-Fae-Internal-Contract.html#t:FaeRequest">FaeRequest</a> argType valType) <a href="src/Blockchain.Fae.Internal.Contract.html#Fae" class="link">Source</a> <a href="#t:Fae" class="selflink">#</a></p><div class="doc"><p>The monad for multi-stage contracts taking an <code>argType</code> and returning
 a <code>valType</code>.  These may not be transactions.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:FaeTX" class="def">FaeTX</a> = <a href="Blockchain-Fae-Internal-Contract.html#t:FaeM">FaeM</a> <a href="../monad-coroutine-0.9.0.3/Control-Monad-Coroutine.html#t:Naught">Naught</a> <a href="src/Blockchain.Fae.Internal.Contract.html#FaeTX" class="link">Source</a> <a href="#t:FaeTX" class="selflink">#</a></p><div class="doc"><p>The monad for single-stage contracts, i.e. transactions.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:ContractT" class="def">ContractT</a> m argType valType = argType -&gt; m (<a href="Blockchain-Fae-Internal-Contract.html#t:WithEscrows">WithEscrows</a> valType) <a href="src/Blockchain.Fae.Internal.Contract.html#ContractT" class="link">Source</a> <a href="#t:ContractT" class="selflink">#</a></p><div class="doc"><p>A &quot;contract transformer&quot;, for use with the <code>MonadContract</code> and
 <code>MonadTX</code> typeclasses.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:Contract" class="def">Contract</a> argType valType = <a href="Blockchain-Fae-Internal-Contract.html#t:ContractT">ContractT</a> (<a href="Blockchain-Fae-Internal-Contract.html#t:Fae">Fae</a> argType valType) argType valType <a href="src/Blockchain.Fae.Internal.Contract.html#Contract" class="link">Source</a> <a href="#t:Contract" class="selflink">#</a></p><div class="doc"><p>This is the type to use when defining a new contract.  Its argument is
 the argument given in the first call to this contract; all subsequent
 calls pass in their arguments via <code>release</code>.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:InternalT" class="def">InternalT</a> s argType valType = <a href="Blockchain-Fae-Internal-Contract.html#t:ContractT">ContractT</a> (<a href="../monad-coroutine-0.9.0.3/Control-Monad-Coroutine.html#t:Coroutine">Coroutine</a> s <a href="Blockchain-Fae-Internal-Contract.html#t:FaeRW">FaeRW</a>) argType valType <a href="src/Blockchain.Fae.Internal.Contract.html#InternalT" class="link">Source</a> <a href="#t:InternalT" class="selflink">#</a></p><div class="doc"><p>An internal representation of a contract, partway through full
 &quot;compilation&quot;.  An <code><a href="Blockchain-Fae-Internal-Contract.html#t:InternalT">InternalT</a></code> has its escrows hidden, because it will
 need to be evaluated inside a <em>different</em> <code><a href="Blockchain-Fae-Internal-Contract.html#t:FaeContract">FaeContract</a></code> monad that has
 its own escrows that shouldn't interfere.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:InternalContract" class="def">InternalContract</a> argType valType = <a href="Blockchain-Fae-Internal-Contract.html#t:InternalT">InternalT</a> (<a href="Blockchain-Fae-Internal-Contract.html#t:FaeRequest">FaeRequest</a> argType valType) (<a href="Blockchain-Fae-Internal-Contract.html#t:WithEscrows">WithEscrows</a> argType) valType <a href="src/Blockchain.Fae.Internal.Contract.html#InternalContract" class="link">Source</a> <a href="#t:InternalContract" class="selflink">#</a></p><div class="doc"><p>Similar to a <code><a href="Blockchain-Fae-Internal-Contract.html#t:Contract">Contract</a></code>, but accepts an escrow-endowed value and
 doesn't expose its escrows.</p></div></div><div class="top"><p class="src"><span class="keyword">newtype</span> <a id="t:ConcreteContract" class="def">ConcreteContract</a> argType valType <a href="src/Blockchain.Fae.Internal.Contract.html#ConcreteContract" class="link">Source</a> <a href="#t:ConcreteContract" class="selflink">#</a></p><div class="doc"><p>A contract is, abstractly, a function that can be called in any Fae
 context, producing a value and a continuation.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:ConcreteContract" class="def">ConcreteContract</a> (<span class="keyword">forall</span> s. <a href="../base-4.9.1.0/Data-Functor.html#t:Functor">Functor</a> s =&gt; argType -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeContract">FaeContract</a> s (<a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> (<a href="Blockchain-Fae-Internal-Contract.html#t:ConcreteContract">ConcreteContract</a> argType valType), valType))</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><p id="control.i:ConcreteContract" class="caption collapser" onclick="toggleSection('i:ConcreteContract')">Instances</p><div id="section.i:ConcreteContract" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:ConcreteContract:MonadTX:1" class="instance expander" onclick="toggleSection('i:id:ConcreteContract:MonadTX:1')"></span> <a href="../base-4.9.1.0/Data-Functor.html#t:Functor">Functor</a> s =&gt; <a href="Blockchain-Fae-Internal-MonadFae.html#t:MonadTX">MonadTX</a> (<a href="Blockchain-Fae-Internal-Contract.html#t:FaeContract">FaeContract</a> s)</span> <a href="src/Blockchain.Fae.Internal.MonadFae.html#line-87" class="link">Source</a> <a href="#t:MonadTX" class="selflink">#</a></td><td class="doc"><p>A little backwards, since <code><a href="Blockchain-Fae-Internal-Contract.html#t:FaeContract">FaeContract</a></code> lies below rather than above
 <code><a href="Blockchain-Fae-Internal-Contract.html#t:FaeTX">FaeTX</a></code>, but they are actually isomorphic, and we need to start the
 monad stack down here so that we can derive <code>forall s. (Functor s) =&gt;
 MonadTX (FaeM s)</code>. </p></td></tr><tr><td colspan="2"><div id="section.i:id:ConcreteContract:MonadTX:1" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:liftTX">liftTX</a> :: <a href="Blockchain-Fae-Internal-Contract.html#t:FaeTX">FaeTX</a> a -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeContract">FaeContract</a> s a <a href="src/Blockchain.Fae.Internal.MonadFae.html#liftTX" class="link">Source</a> <a href="#v:liftTX" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:ConcreteContract:NFData:2" class="instance expander" onclick="toggleSection('i:id:ConcreteContract:NFData:2')"></span> <a href="Blockchain-Fae.html#t:NFData">NFData</a> (<a href="Blockchain-Fae-Internal-Contract.html#t:ConcreteContract">ConcreteContract</a> argType valType)</span> <a href="src/Blockchain.Fae.Internal.Contract.html#line-158" class="link">Source</a> <a href="#t:ConcreteContract" class="selflink">#</a></td><td class="doc"><p>Escrows are contracts, so we need this for <code>NFData Escrows</code>.</p></td></tr><tr><td colspan="2"><div id="section.i:id:ConcreteContract:NFData:2" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:rnf">rnf</a> :: <a href="Blockchain-Fae-Internal-Contract.html#t:ConcreteContract">ConcreteContract</a> argType valType -&gt; () <a href="#v:rnf" class="selflink">#</a></p></div></div></td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:AbstractEscrow" class="def">AbstractEscrow</a> = <a href="Blockchain-Fae-Internal-Contract.html#t:ConcreteContract">ConcreteContract</a> <a href="../base-4.9.1.0/Data-Dynamic.html#t:Dynamic">Dynamic</a> <a href="../base-4.9.1.0/Data-Dynamic.html#t:Dynamic">Dynamic</a> <a href="src/Blockchain.Fae.Internal.Contract.html#AbstractEscrow" class="link">Source</a> <a href="#t:AbstractEscrow" class="selflink">#</a></p><div class="doc"><p>The type actually stored in the escrows map, because escrows can have
 any types of input and output.  Abstract escrows take arbitrary argument
 types.</p></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:AbstractContract" class="def">AbstractContract</a> = <a href="Blockchain-Fae-Internal-Contract.html#t:ConcreteContract">ConcreteContract</a> <a href="Blockchain-Fae-Internal-Contract.html#t:Input">Input</a> <a href="../base-4.9.1.0/Data-Dynamic.html#t:Dynamic">Dynamic</a> <a href="src/Blockchain.Fae.Internal.Contract.html#AbstractContract" class="link">Source</a> <a href="#t:AbstractContract" class="selflink">#</a></p><div class="doc"><p>The type actually stored in a <code><a href="Blockchain-Fae-Internal-Storage.html#v:TransactionEntry">TransactionEntry</a></code>, because contracts
 can have any types of input and output.  Abstract contracts only take
 string inputs, which they have to parse into the argument type they
 expect.  This prevents malicious users from injecting their own code
 into transactions' contract calls.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:ContractException" class="def">ContractException</a> <a href="src/Blockchain.Fae.Internal.Contract.html#ContractException" class="link">Source</a> <a href="#t:ContractException" class="selflink">#</a></p><div class="doc"><p>Exception type</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:BadInputParse" class="def">BadInputParse</a> <a href="../base-4.9.1.0/Data-String.html#t:String">String</a> <a href="../base-4.9.1.0/Data-Typeable-Internal.html#t:TypeRep">TypeRep</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:BadArgType" class="def">BadArgType</a> <a href="../base-4.9.1.0/Data-Typeable-Internal.html#t:TypeRep">TypeRep</a> <a href="../base-4.9.1.0/Data-Typeable-Internal.html#t:TypeRep">TypeRep</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:BadValType" class="def">BadValType</a> <a href="../base-4.9.1.0/Data-Typeable-Internal.html#t:TypeRep">TypeRep</a> <a href="../base-4.9.1.0/Data-Typeable-Internal.html#t:TypeRep">TypeRep</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:BadEscrowID" class="def">BadEscrowID</a> <a href="Blockchain-Fae-Internal-IDs.html#t:EntryID">EntryID</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><p id="control.i:ContractException" class="caption collapser" onclick="toggleSection('i:ContractException')">Instances</p><div id="section.i:ContractException" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:ContractException:Show:1" class="instance expander" onclick="toggleSection('i:id:ContractException:Show:1')"></span> <a href="../base-4.9.1.0/Text-Show.html#t:Show">Show</a> <a href="Blockchain-Fae-Internal-Contract.html#t:ContractException">ContractException</a></span> <a href="src/Blockchain.Fae.Internal.Contract.html#line-123" class="link">Source</a> <a href="#t:ContractException" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:id:ContractException:Show:1" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:showsPrec">showsPrec</a> :: <a href="../base-4.9.1.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:ContractException">ContractException</a> -&gt; <a href="../base-4.9.1.0/Text-Show.html#t:ShowS">ShowS</a> <a href="#v:showsPrec" class="selflink">#</a></p><p class="src"><a href="#v:show">show</a> :: <a href="Blockchain-Fae-Internal-Contract.html#t:ContractException">ContractException</a> -&gt; <a href="../base-4.9.1.0/Data-String.html#t:String">String</a> <a href="#v:show" class="selflink">#</a></p><p class="src"><a href="#v:showList">showList</a> :: [<a href="Blockchain-Fae-Internal-Contract.html#t:ContractException">ContractException</a>] -&gt; <a href="../base-4.9.1.0/Text-Show.html#t:ShowS">ShowS</a> <a href="#v:showList" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:ContractException:Exception:2" class="instance expander" onclick="toggleSection('i:id:ContractException:Exception:2')"></span> <a href="../base-4.9.1.0/Control-Exception-Base.html#t:Exception">Exception</a> <a href="Blockchain-Fae-Internal-Contract.html#t:ContractException">ContractException</a></span> <a href="src/Blockchain.Fae.Internal.Contract.html#line-151" class="link">Source</a> <a href="#t:ContractException" class="selflink">#</a></td><td class="doc"><p>Of course</p></td></tr><tr><td colspan="2"><div id="section.i:id:ContractException:Exception:2" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:toException">toException</a> :: <a href="Blockchain-Fae-Internal-Contract.html#t:ContractException">ContractException</a> -&gt; <a href="../base-4.9.1.0/Control-Exception-Base.html#t:SomeException">SomeException</a> <a href="#v:toException" class="selflink">#</a></p><p class="src"><a href="#v:fromException">fromException</a> :: <a href="../base-4.9.1.0/Control-Exception-Base.html#t:SomeException">SomeException</a> -&gt; <a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Blockchain-Fae-Internal-Contract.html#t:ContractException">ContractException</a> <a href="#v:fromException" class="selflink">#</a></p><p class="src"><a href="#v:displayException">displayException</a> :: <a href="Blockchain-Fae-Internal-Contract.html#t:ContractException">ContractException</a> -&gt; <a href="../base-4.9.1.0/Data-String.html#t:String">String</a> <a href="#v:displayException" class="selflink">#</a></p></div></div></td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Input" class="def">Input</a> <a href="src/Blockchain.Fae.Internal.Contract.html#Input" class="link">Source</a> <a href="#t:Input" class="selflink">#</a></p><div class="doc"><p>A representation of an input contract call, containing a reference
 object (for resolving escrow locators) and an argument string to be
 parsed into the correct argument type.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a href="Blockchain-Fae-Internal-IDs.html#t:HasEscrowIDs">HasEscrowIDs</a> a =&gt; <a id="v:Input" class="def">Input</a> a <a href="../base-4.9.1.0/Data-String.html#t:String">String</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><p id="control.i:Input" class="caption collapser" onclick="toggleSection('i:Input')">Instances</p><div id="section.i:Input" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:Input:MonadTX:1" class="instance expander" onclick="toggleSection('i:id:Input:MonadTX:1')"></span> <a href="../base-4.9.1.0/Data-Functor.html#t:Functor">Functor</a> s =&gt; <a href="Blockchain-Fae-Internal-MonadFae.html#t:MonadTX">MonadTX</a> (<a href="Blockchain-Fae-Internal-Contract.html#t:FaeContract">FaeContract</a> s)</span> <a href="src/Blockchain.Fae.Internal.MonadFae.html#line-87" class="link">Source</a> <a href="#t:MonadTX" class="selflink">#</a></td><td class="doc"><p>A little backwards, since <code><a href="Blockchain-Fae-Internal-Contract.html#t:FaeContract">FaeContract</a></code> lies below rather than above
 <code><a href="Blockchain-Fae-Internal-Contract.html#t:FaeTX">FaeTX</a></code>, but they are actually isomorphic, and we need to start the
 monad stack down here so that we can derive <code>forall s. (Functor s) =&gt;
 MonadTX (FaeM s)</code>. </p></td></tr><tr><td colspan="2"><div id="section.i:id:Input:MonadTX:1" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:liftTX">liftTX</a> :: <a href="Blockchain-Fae-Internal-Contract.html#t:FaeTX">FaeTX</a> a -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeContract">FaeContract</a> s a <a href="src/Blockchain.Fae.Internal.MonadFae.html#liftTX" class="link">Source</a> <a href="#v:liftTX" class="selflink">#</a></p></div></div></td></tr></table></div></div></div><h1 id="g:2">Type classes</h1><div class="top"><p class="src"><span class="keyword">class</span> <a id="t:ReadInput" class="def">ReadInput</a> a <span class="keyword">where</span> <a href="src/Blockchain.Fae.Internal.Contract.html#ReadInput" class="link">Source</a> <a href="#t:ReadInput" class="selflink">#</a></p><div class="doc"><p>For reading contract arguments as transaction inputs.  Since it is
 fully defaulted, no one should ever have to define an instance
 explicitly.  In fact, we don't even export the class members from
 <code><a href="Blockchain.html#v:Fae">Fae</a></code>, because it is important to the internal workings of
 Fae that <code><a href="Blockchain-Fae-Internal-Contract.html#v:readInput">readInput</a></code> behave in this way.</p></div><div class="subs methods"><p class="caption">Methods</p><p class="src"><a id="v:readInput" class="def">readInput</a> :: <a href="Blockchain-Fae-Internal-Contract.html#t:Input">Input</a> -&gt; a <a href="src/Blockchain.Fae.Internal.Contract.html#readInput" class="link">Source</a> <a href="#v:readInput" class="selflink">#</a></p><div class="doc"><p>Like <code><a href="../base-4.9.1.0/Text-Read.html#v:read">read</a></code>, but with a little extra data.
 The default instance reads the argument string, then resolves escrow
 locators in it.</p></div><p class="src"><a id="v:readInput" class="def">readInput</a> :: (<a href="../base-4.9.1.0/Text-Read.html#t:Read">Read</a> a, <a href="Blockchain-Fae-Internal-Exceptions.html#t:Typeable">Typeable</a> a) =&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:Input">Input</a> -&gt; a <a href="src/Blockchain.Fae.Internal.Contract.html#readInput" class="link">Source</a> <a href="#v:readInput" class="selflink">#</a></p><div class="doc"><p>Like <code><a href="../base-4.9.1.0/Text-Read.html#v:read">read</a></code>, but with a little extra data.
 The default instance reads the argument string, then resolves escrow
 locators in it.</p></div></div><div class="subs instances"><p id="control.i:ReadInput" class="caption collapser" onclick="toggleSection('i:ReadInput')">Instances</p><div id="section.i:ReadInput" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:ic:ReadInput:ReadInput:1" class="instance expander" onclick="toggleSection('i:ic:ReadInput:ReadInput:1')"></span> <a href="Blockchain-Fae-Internal-Contract.html#t:ReadInput">ReadInput</a> <a href="../base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a></span> <a href="src/Blockchain.Fae.Internal.Contract.html#line-166" class="link">Source</a> <a href="#t:ReadInput" class="selflink">#</a></td><td class="doc"><p>Default instance</p></td></tr><tr><td colspan="2"><div id="section.i:ic:ReadInput:ReadInput:1" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:readInput">readInput</a> :: <a href="Blockchain-Fae-Internal-Contract.html#t:Input">Input</a> -&gt; <a href="../base-4.9.1.0/Data-Bool.html#t:Bool">Bool</a> <a href="src/Blockchain.Fae.Internal.Contract.html#readInput" class="link">Source</a> <a href="#v:readInput" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:ic:ReadInput:ReadInput:2" class="instance expander" onclick="toggleSection('i:ic:ReadInput:ReadInput:2')"></span> <a href="Blockchain-Fae-Internal-Contract.html#t:ReadInput">ReadInput</a> <a href="../base-4.9.1.0/Data-Char.html#t:Char">Char</a></span> <a href="src/Blockchain.Fae.Internal.Contract.html#line-168" class="link">Source</a> <a href="#t:ReadInput" class="selflink">#</a></td><td class="doc"><p>Default instance</p></td></tr><tr><td colspan="2"><div id="section.i:ic:ReadInput:ReadInput:2" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:readInput">readInput</a> :: <a href="Blockchain-Fae-Internal-Contract.html#t:Input">Input</a> -&gt; <a href="../base-4.9.1.0/Data-Char.html#t:Char">Char</a> <a href="src/Blockchain.Fae.Internal.Contract.html#readInput" class="link">Source</a> <a href="#v:readInput" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:ic:ReadInput:ReadInput:3" class="instance expander" onclick="toggleSection('i:ic:ReadInput:ReadInput:3')"></span> <a href="Blockchain-Fae-Internal-Contract.html#t:ReadInput">ReadInput</a> <a href="../base-4.9.1.0/Prelude.html#t:Double">Double</a></span> <a href="src/Blockchain.Fae.Internal.Contract.html#line-176" class="link">Source</a> <a href="#t:ReadInput" class="selflink">#</a></td><td class="doc"><p>Default instance</p></td></tr><tr><td colspan="2"><div id="section.i:ic:ReadInput:ReadInput:3" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:readInput">readInput</a> :: <a href="Blockchain-Fae-Internal-Contract.html#t:Input">Input</a> -&gt; <a href="../base-4.9.1.0/Prelude.html#t:Double">Double</a> <a href="src/Blockchain.Fae.Internal.Contract.html#readInput" class="link">Source</a> <a href="#v:readInput" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:ic:ReadInput:ReadInput:4" class="instance expander" onclick="toggleSection('i:ic:ReadInput:ReadInput:4')"></span> <a href="Blockchain-Fae-Internal-Contract.html#t:ReadInput">ReadInput</a> <a href="../base-4.9.1.0/Prelude.html#t:Float">Float</a></span> <a href="src/Blockchain.Fae.Internal.Contract.html#line-174" class="link">Source</a> <a href="#t:ReadInput" class="selflink">#</a></td><td class="doc"><p>Default instance</p></td></tr><tr><td colspan="2"><div id="section.i:ic:ReadInput:ReadInput:4" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:readInput">readInput</a> :: <a href="Blockchain-Fae-Internal-Contract.html#t:Input">Input</a> -&gt; <a href="../base-4.9.1.0/Prelude.html#t:Float">Float</a> <a href="src/Blockchain.Fae.Internal.Contract.html#readInput" class="link">Source</a> <a href="#v:readInput" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:ic:ReadInput:ReadInput:5" class="instance expander" onclick="toggleSection('i:ic:ReadInput:ReadInput:5')"></span> <a href="Blockchain-Fae-Internal-Contract.html#t:ReadInput">ReadInput</a> <a href="../base-4.9.1.0/Data-Int.html#t:Int">Int</a></span> <a href="src/Blockchain.Fae.Internal.Contract.html#line-170" class="link">Source</a> <a href="#t:ReadInput" class="selflink">#</a></td><td class="doc"><p>Default instance</p></td></tr><tr><td colspan="2"><div id="section.i:ic:ReadInput:ReadInput:5" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:readInput">readInput</a> :: <a href="Blockchain-Fae-Internal-Contract.html#t:Input">Input</a> -&gt; <a href="../base-4.9.1.0/Data-Int.html#t:Int">Int</a> <a href="src/Blockchain.Fae.Internal.Contract.html#readInput" class="link">Source</a> <a href="#v:readInput" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:ic:ReadInput:ReadInput:6" class="instance expander" onclick="toggleSection('i:ic:ReadInput:ReadInput:6')"></span> <a href="Blockchain-Fae-Internal-Contract.html#t:ReadInput">ReadInput</a> <a href="../base-4.9.1.0/Prelude.html#t:Integer">Integer</a></span> <a href="src/Blockchain.Fae.Internal.Contract.html#line-172" class="link">Source</a> <a href="#t:ReadInput" class="selflink">#</a></td><td class="doc"><p>Default instance</p></td></tr><tr><td colspan="2"><div id="section.i:ic:ReadInput:ReadInput:6" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:readInput">readInput</a> :: <a href="Blockchain-Fae-Internal-Contract.html#t:Input">Input</a> -&gt; <a href="../base-4.9.1.0/Prelude.html#t:Integer">Integer</a> <a href="src/Blockchain.Fae.Internal.Contract.html#readInput" class="link">Source</a> <a href="#v:readInput" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:ic:ReadInput:ReadInput:7" class="instance expander" onclick="toggleSection('i:ic:ReadInput:ReadInput:7')"></span> <a href="Blockchain-Fae-Internal-Contract.html#t:ReadInput">ReadInput</a> ()</span> <a href="src/Blockchain.Fae.Internal.Contract.html#line-164" class="link">Source</a> <a href="#t:ReadInput" class="selflink">#</a></td><td class="doc"><p>Default instance</p></td></tr><tr><td colspan="2"><div id="section.i:ic:ReadInput:ReadInput:7" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:readInput">readInput</a> :: <a href="Blockchain-Fae-Internal-Contract.html#t:Input">Input</a> -&gt; () <a href="src/Blockchain.Fae.Internal.Contract.html#readInput" class="link">Source</a> <a href="#v:readInput" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:ic:ReadInput:ReadInput:8" class="instance expander" onclick="toggleSection('i:ic:ReadInput:ReadInput:8')"></span> <a href="Blockchain-Fae-Internal-Contract.html#t:ReadInput">ReadInput</a> <a href="Blockchain-Fae.html#t:Void">Void</a></span> <a href="src/Blockchain.Fae.Internal.Contract.html#line-162" class="link">Source</a> <a href="#t:ReadInput" class="selflink">#</a></td><td class="doc"><p>Default instance</p></td></tr><tr><td colspan="2"><div id="section.i:ic:ReadInput:ReadInput:8" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:readInput">readInput</a> :: <a href="Blockchain-Fae-Internal-Contract.html#t:Input">Input</a> -&gt; <a href="Blockchain-Fae.html#t:Void">Void</a> <a href="src/Blockchain.Fae.Internal.Contract.html#readInput" class="link">Source</a> <a href="#v:readInput" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:ic:ReadInput:ReadInput:9" class="instance expander" onclick="toggleSection('i:ic:ReadInput:ReadInput:9')"></span> <a href="Blockchain-Fae-Internal-Contract.html#t:ReadInput">ReadInput</a> <a href="Blockchain-Fae-Contracts.html#t:TwoPartyVote">TwoPartyVote</a></span> <a href="src/Blockchain.Fae.Internal.Contract.html#line-97" class="link">Source</a> <a href="#t:ReadInput" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:ic:ReadInput:ReadInput:9" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:readInput">readInput</a> :: <a href="Blockchain-Fae-Internal-Contract.html#t:Input">Input</a> -&gt; <a href="Blockchain-Fae-Contracts.html#t:TwoPartyVote">TwoPartyVote</a> <a href="src/Blockchain.Fae.Internal.Contract.html#readInput" class="link">Source</a> <a href="#v:readInput" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:ic:ReadInput:ReadInput:10" class="instance expander" onclick="toggleSection('i:ic:ReadInput:ReadInput:10')"></span> (<a href="../base-4.9.1.0/Text-Read.html#t:Read">Read</a> a, <a href="Blockchain-Fae-Internal-Exceptions.html#t:Typeable">Typeable</a> <a href="../base-4.9.1.0/Data-Kind.html#t:-42-">*</a> a) =&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:ReadInput">ReadInput</a> [a]</span> <a href="src/Blockchain.Fae.Internal.Contract.html#line-178" class="link">Source</a> <a href="#t:ReadInput" class="selflink">#</a></td><td class="doc"><p>Default instance</p></td></tr><tr><td colspan="2"><div id="section.i:ic:ReadInput:ReadInput:10" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:readInput">readInput</a> :: <a href="Blockchain-Fae-Internal-Contract.html#t:Input">Input</a> -&gt; [a] <a href="src/Blockchain.Fae.Internal.Contract.html#readInput" class="link">Source</a> <a href="#v:readInput" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:ic:ReadInput:ReadInput:11" class="instance expander" onclick="toggleSection('i:ic:ReadInput:ReadInput:11')"></span> (<a href="../base-4.9.1.0/Text-Read.html#t:Read">Read</a> a, <a href="Blockchain-Fae-Internal-Exceptions.html#t:Typeable">Typeable</a> <a href="../base-4.9.1.0/Data-Kind.html#t:-42-">*</a> a) =&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:ReadInput">ReadInput</a> (<a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> a)</span> <a href="src/Blockchain.Fae.Internal.Contract.html#line-180" class="link">Source</a> <a href="#t:ReadInput" class="selflink">#</a></td><td class="doc"><p>Default instance</p></td></tr><tr><td colspan="2"><div id="section.i:ic:ReadInput:ReadInput:11" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:readInput">readInput</a> :: <a href="Blockchain-Fae-Internal-Contract.html#t:Input">Input</a> -&gt; <a href="../base-4.9.1.0/Data-Maybe.html#t:Maybe">Maybe</a> a <a href="src/Blockchain.Fae.Internal.Contract.html#readInput" class="link">Source</a> <a href="#v:readInput" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:ic:ReadInput:ReadInput:12" class="instance expander" onclick="toggleSection('i:ic:ReadInput:ReadInput:12')"></span> (<a href="../base-4.9.1.0/Text-Read.html#t:Read">Read</a> a, <a href="Blockchain-Fae-Internal-Exceptions.html#t:Typeable">Typeable</a> <a href="../base-4.9.1.0/Data-Kind.html#t:-42-">*</a> a, <a href="../base-4.9.1.0/Text-Read.html#t:Read">Read</a> b, <a href="Blockchain-Fae-Internal-Exceptions.html#t:Typeable">Typeable</a> <a href="../base-4.9.1.0/Data-Kind.html#t:-42-">*</a> b) =&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:ReadInput">ReadInput</a> (<a href="../base-4.9.1.0/Data-Either.html#t:Either">Either</a> a b)</span> <a href="src/Blockchain.Fae.Internal.Contract.html#line-184" class="link">Source</a> <a href="#t:ReadInput" class="selflink">#</a></td><td class="doc"><p>Default instance</p></td></tr><tr><td colspan="2"><div id="section.i:ic:ReadInput:ReadInput:12" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:readInput">readInput</a> :: <a href="Blockchain-Fae-Internal-Contract.html#t:Input">Input</a> -&gt; <a href="../base-4.9.1.0/Data-Either.html#t:Either">Either</a> a b <a href="src/Blockchain.Fae.Internal.Contract.html#readInput" class="link">Source</a> <a href="#v:readInput" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:ic:ReadInput:ReadInput:13" class="instance expander" onclick="toggleSection('i:ic:ReadInput:ReadInput:13')"></span> (<a href="../base-4.9.1.0/Text-Read.html#t:Read">Read</a> a, <a href="Blockchain-Fae-Internal-Exceptions.html#t:Typeable">Typeable</a> <a href="../base-4.9.1.0/Data-Kind.html#t:-42-">*</a> a, <a href="../base-4.9.1.0/Text-Read.html#t:Read">Read</a> b, <a href="Blockchain-Fae-Internal-Exceptions.html#t:Typeable">Typeable</a> <a href="../base-4.9.1.0/Data-Kind.html#t:-42-">*</a> b) =&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:ReadInput">ReadInput</a> (a, b)</span> <a href="src/Blockchain.Fae.Internal.Contract.html#line-182" class="link">Source</a> <a href="#t:ReadInput" class="selflink">#</a></td><td class="doc"><p>Default instance</p></td></tr><tr><td colspan="2"><div id="section.i:ic:ReadInput:ReadInput:13" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:readInput">readInput</a> :: <a href="Blockchain-Fae-Internal-Contract.html#t:Input">Input</a> -&gt; (a, b) <a href="src/Blockchain.Fae.Internal.Contract.html#readInput" class="link">Source</a> <a href="#v:readInput" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:ic:ReadInput:ReadInput:14" class="instance expander" onclick="toggleSection('i:ic:ReadInput:ReadInput:14')"></span> (<a href="Blockchain-Fae-Internal-Exceptions.html#t:Typeable">Typeable</a> <a href="../base-4.9.1.0/Data-Kind.html#t:-42-">*</a> argType, <a href="Blockchain-Fae-Internal-Exceptions.html#t:Typeable">Typeable</a> <a href="../base-4.9.1.0/Data-Kind.html#t:-42-">*</a> valType) =&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:ReadInput">ReadInput</a> (<a href="Blockchain-Fae-Internal-IDs.html#t:EscrowID">EscrowID</a> argType valType)</span> <a href="src/Blockchain.Fae.Internal.Contract.html#line-187" class="link">Source</a> <a href="#t:ReadInput" class="selflink">#</a></td><td class="doc"><p>Default instance</p></td></tr><tr><td colspan="2"><div id="section.i:ic:ReadInput:ReadInput:14" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:readInput">readInput</a> :: <a href="Blockchain-Fae-Internal-Contract.html#t:Input">Input</a> -&gt; <a href="Blockchain-Fae-Internal-IDs.html#t:EscrowID">EscrowID</a> argType valType <a href="src/Blockchain.Fae.Internal.Contract.html#readInput" class="link">Source</a> <a href="#v:readInput" class="selflink">#</a></p></div></div></td></tr></table></div></div></div><h1 id="g:3">Template Haskell</h1><div class="top"><p class="src"><a id="v:_nextID" class="def">_nextID</a> :: <a href="../lens-4.15.4/Control-Lens-Type.html#t:Lens-39-">Lens'</a> <a href="Blockchain-Fae-Internal-Contract.html#t:Escrows">Escrows</a> <a href="Blockchain-Fae-Internal-IDs.html#t:EntryID">EntryID</a> <a href="src/Blockchain.Fae.Internal.Contract.html#line-192" class="link">Source</a> <a href="#v:_nextID" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:_escrowMap" class="def">_escrowMap</a> :: <a href="../lens-4.15.4/Control-Lens-Type.html#t:Lens-39-">Lens'</a> <a href="Blockchain-Fae-Internal-Contract.html#t:Escrows">Escrows</a> <a href="Blockchain-Fae-Internal-Contract.html#t:EscrowMap">EscrowMap</a> <a href="src/Blockchain.Fae.Internal.Contract.html#line-192" class="link">Source</a> <a href="#v:_escrowMap" class="selflink">#</a></p></div><h1 id="g:4">Functions</h1><div class="top"><p class="src"><a id="v:makeEscrow" class="def">makeEscrow</a> :: (<a href="Blockchain-Fae-Internal-IDs.html#t:HasEscrowIDs">HasEscrowIDs</a> argType, <a href="Blockchain-Fae-Internal-IDs.html#t:HasEscrowIDs">HasEscrowIDs</a> valType, <a href="Blockchain-Fae-Internal-Exceptions.html#t:Typeable">Typeable</a> argType, <a href="Blockchain-Fae-Internal-Exceptions.html#t:Typeable">Typeable</a> valType, <a href="Blockchain-Fae.html#t:NFData">NFData</a> argType, <a href="../base-4.9.1.0/Data-Functor.html#t:Functor">Functor</a> s) =&gt; [<a href="Blockchain-Fae-Internal-IDs.html#t:BearsValue">BearsValue</a>] -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:Contract">Contract</a> argType valType -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeContract">FaeContract</a> s <a href="Blockchain-Fae-Internal-Contract.html#t:AbstractEscrow">AbstractEscrow</a> <a href="src/Blockchain.Fae.Internal.Contract.html#makeEscrow" class="link">Source</a> <a href="#v:makeEscrow" class="selflink">#</a></p><div class="doc"><p>The high-level escrow constructor, which goes from what a contract
 author provides to the internal representation of an escrow.</p></div></div><div class="top"><p class="src"><a id="v:makeContract" class="def">makeContract</a> :: (<a href="Blockchain-Fae-Internal-IDs.html#t:HasEscrowIDs">HasEscrowIDs</a> argType, <a href="Blockchain-Fae-Internal-IDs.html#t:HasEscrowIDs">HasEscrowIDs</a> valType, <a href="Blockchain-Fae-Internal-Contract.html#t:ReadInput">ReadInput</a> argType, <a href="Blockchain-Fae-Internal-Exceptions.html#t:Typeable">Typeable</a> argType, <a href="Blockchain-Fae-Internal-Exceptions.html#t:Typeable">Typeable</a> valType, <a href="../base-4.9.1.0/Data-Functor.html#t:Functor">Functor</a> s) =&gt; [<a href="Blockchain-Fae-Internal-IDs.html#t:BearsValue">BearsValue</a>] -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:Contract">Contract</a> argType valType -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeContract">FaeContract</a> s <a href="Blockchain-Fae-Internal-Contract.html#t:AbstractContract">AbstractContract</a> <a href="src/Blockchain.Fae.Internal.Contract.html#makeContract" class="link">Source</a> <a href="#v:makeContract" class="selflink">#</a></p><div class="doc"><p>The high-level contract constructor, which goes from what a contract
 author provides to the internal representation of a contract.</p></div></div><div class="top"><p class="src"><a id="v:makeInternalT" class="def">makeInternalT</a> :: (<a href="../base-4.9.1.0/Data-Functor.html#t:Functor">Functor</a> s, <a href="../base-4.9.1.0/Data-Functor.html#t:Functor">Functor</a> s') =&gt; [<a href="Blockchain-Fae-Internal-IDs.html#t:BearsValue">BearsValue</a>] -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:ContractT">ContractT</a> (<a href="Blockchain-Fae-Internal-Contract.html#t:FaeContract">FaeContract</a> s') argType valType -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeContract">FaeContract</a> s (<a href="Blockchain-Fae-Internal-Contract.html#t:InternalT">InternalT</a> s' (<a href="Blockchain-Fae-Internal-Contract.html#t:WithEscrows">WithEscrows</a> argType) valType) <a href="src/Blockchain.Fae.Internal.Contract.html#makeInternalT" class="link">Source</a> <a href="#v:makeInternalT" class="selflink">#</a></p><div class="doc"><p>Processes a <code><a href="Blockchain-Fae-Internal-Contract.html#t:Contract">Contract</a></code> so that it can take escrows on the first call,
 and hides the escrow storage.</p></div></div><div class="top"><p class="src"><a id="v:makeEscrowConcrete" class="def">makeEscrowConcrete</a> :: (<a href="Blockchain-Fae-Internal-IDs.html#t:HasEscrowIDs">HasEscrowIDs</a> argType, <a href="Blockchain-Fae-Internal-IDs.html#t:HasEscrowIDs">HasEscrowIDs</a> valType, <a href="Blockchain-Fae.html#t:NFData">NFData</a> argType) =&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:InternalContract">InternalContract</a> argType valType -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:ConcreteContract">ConcreteContract</a> argType valType <a href="src/Blockchain.Fae.Internal.Contract.html#makeEscrowConcrete" class="link">Source</a> <a href="#v:makeEscrowConcrete" class="selflink">#</a></p><div class="doc"><p>Uniform definition.  The non-escrow-endowed input to
 a <code><a href="Blockchain-Fae-Internal-Contract.html#t:ConcreteContract">ConcreteContract</a></code> is scanned for escrow IDs before it is passed in.</p></div></div><div class="top"><p class="src"><a id="v:makeContractConcrete" class="def">makeContractConcrete</a> :: (<a href="Blockchain-Fae-Internal-IDs.html#t:HasEscrowIDs">HasEscrowIDs</a> argType, <a href="Blockchain-Fae-Internal-IDs.html#t:HasEscrowIDs">HasEscrowIDs</a> valType) =&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:InternalContract">InternalContract</a> argType valType -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:ConcreteContract">ConcreteContract</a> argType valType <a href="src/Blockchain.Fae.Internal.Contract.html#makeContractConcrete" class="link">Source</a> <a href="#v:makeContractConcrete" class="selflink">#</a></p><div class="doc"><p>Uniform definition.  A contract argument is never endowed with
 escrows, because it is a security hole to allow callers to pass their
 own code to called contracts.  This is what transactional escrows
 handle.</p></div></div><div class="top"><p class="src"><a id="v:makeConcrete" class="def">makeConcrete</a> :: (<a href="Blockchain-Fae-Internal-IDs.html#t:HasEscrowIDs">HasEscrowIDs</a> argType, <a href="Blockchain-Fae-Internal-IDs.html#t:HasEscrowIDs">HasEscrowIDs</a> valType) =&gt; (<span class="keyword">forall</span> s. <a href="../base-4.9.1.0/Data-Functor.html#t:Functor">Functor</a> s =&gt; argType -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeContract">FaeContract</a> s (<a href="Blockchain-Fae-Internal-Contract.html#t:WithEscrows">WithEscrows</a> argType)) -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:InternalContract">InternalContract</a> argType valType -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:ConcreteContract">ConcreteContract</a> argType valType <a href="src/Blockchain.Fae.Internal.Contract.html#makeConcrete" class="link">Source</a> <a href="#v:makeConcrete" class="selflink">#</a></p><div class="doc"><p>Takes care of running the contract coroutine and extracting the
 continuation.  It also correctly retrieves escrows from the argument and
 places the escrows of the return value into the local storage.</p></div></div><div class="top"><p class="src"><a id="v:makeEscrowAbstract" class="def">makeEscrowAbstract</a> :: <span class="keyword">forall</span> argType valType. (<a href="Blockchain-Fae-Internal-Exceptions.html#t:Typeable">Typeable</a> argType, <a href="Blockchain-Fae-Internal-Exceptions.html#t:Typeable">Typeable</a> valType) =&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:ConcreteContract">ConcreteContract</a> argType valType -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:AbstractEscrow">AbstractEscrow</a> <a href="src/Blockchain.Fae.Internal.Contract.html#makeEscrowAbstract" class="link">Source</a> <a href="#v:makeEscrowAbstract" class="selflink">#</a></p><div class="doc"><p>An abstract escrow just needs to check the type of its input and clear
 the type of its output.</p></div></div><div class="top"><p class="src"><a id="v:makeContractAbstract" class="def">makeContractAbstract</a> :: <span class="keyword">forall</span> argType valType. (<a href="Blockchain-Fae-Internal-Contract.html#t:ReadInput">ReadInput</a> argType, <a href="Blockchain-Fae-Internal-Exceptions.html#t:Typeable">Typeable</a> argType, <a href="Blockchain-Fae-Internal-Exceptions.html#t:Typeable">Typeable</a> valType) =&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:ConcreteContract">ConcreteContract</a> argType valType -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:AbstractContract">AbstractContract</a> <a href="src/Blockchain.Fae.Internal.Contract.html#makeContractAbstract" class="link">Source</a> <a href="#v:makeContractAbstract" class="selflink">#</a></p><div class="doc"><p>An abstract contract just needs to parse its input and clear the
 output type.</p></div></div><div class="top"><p class="src"><a id="v:unmakeAbstractEscrow" class="def">unmakeAbstractEscrow</a> :: <span class="keyword">forall</span> argType valType. (<a href="Blockchain-Fae-Internal-Exceptions.html#t:Typeable">Typeable</a> argType, <a href="Blockchain-Fae-Internal-Exceptions.html#t:Typeable">Typeable</a> valType) =&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:AbstractEscrow">AbstractEscrow</a> -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:ConcreteContract">ConcreteContract</a> argType valType <a href="src/Blockchain.Fae.Internal.Contract.html#unmakeAbstractEscrow" class="link">Source</a> <a href="#v:unmakeAbstractEscrow" class="selflink">#</a></p><div class="doc"><p>Because when we call an escrow, we actually know exactly what type was
 given as its argument and expected as its result.</p></div></div><div class="top"><p class="src"><a id="v:takeEscrows" class="def">takeEscrows</a> :: <a href="../adjunctions-4.3/Control-Monad-Representable-State.html#t:MonadState">MonadState</a> <a href="Blockchain-Fae-Internal-Contract.html#t:Escrows">Escrows</a> m =&gt; [<a href="Blockchain-Fae-Internal-IDs.html#t:BearsValue">BearsValue</a>] -&gt; m <a href="Blockchain-Fae-Internal-Contract.html#t:Escrows">Escrows</a> <a href="src/Blockchain.Fae.Internal.Contract.html#takeEscrows" class="link">Source</a> <a href="#v:takeEscrows" class="selflink">#</a></p><div class="doc"><p>Retrieves backing escrows from value-bearing objects.</p></div></div><div class="top"><p class="src"><a id="v:getEscrowMap" class="def">getEscrowMap</a> :: <span class="keyword">forall</span> m. <a href="../adjunctions-4.3/Control-Monad-Representable-State.html#t:MonadState">MonadState</a> <a href="Blockchain-Fae-Internal-Contract.html#t:Escrows">Escrows</a> m =&gt; [<a href="Blockchain-Fae-Internal-IDs.html#t:BearsValue">BearsValue</a>] -&gt; m <a href="Blockchain-Fae-Internal-Contract.html#t:EscrowMap">EscrowMap</a> <a href="src/Blockchain.Fae.Internal.Contract.html#getEscrowMap" class="link">Source</a> <a href="#v:getEscrowMap" class="selflink">#</a></p><div class="doc"><p>Just concatenates the list of all escrows in each of the objects, then
 turns it into a map.  Internally, this uses an imiation of the <code>lens</code>
 function <code>toList</code> for <code><a href="../lens-4.15.4/Control-Lens-Type.html#t:Traversal">Traversal</a></code>s, but since an <code><a href="Blockchain-Fae-Internal-IDs.html#t:EscrowIDTraversal">EscrowIDTraversal</a></code> is
 not <em>exactly</em> a <code><a href="../lens-4.15.4/Control-Lens-Type.html#t:Traversal">Traversal</a></code>, we have to reproduce it.</p></div></div><div class="top"><p class="src"><a id="v:takeEscrow" class="def">takeEscrow</a> :: <a href="../adjunctions-4.3/Control-Monad-Representable-State.html#t:MonadState">MonadState</a> <a href="Blockchain-Fae-Internal-Contract.html#t:Escrows">Escrows</a> m =&gt; <a href="Blockchain-Fae-Internal-IDs.html#t:EscrowID">EscrowID</a> argType valType -&gt; m (<a href="Blockchain-Fae-Internal-IDs.html#t:EntryID">EntryID</a>, <a href="Blockchain-Fae-Internal-Contract.html#t:AbstractEscrow">AbstractEscrow</a>) <a href="src/Blockchain.Fae.Internal.Contract.html#takeEscrow" class="link">Source</a> <a href="#v:takeEscrow" class="selflink">#</a></p><div class="doc"><p>Actually looks up an escrow by ID.  If an escrow locator has made it
 this far, this is where it causes an error.  This function actually
 <em>takes</em> the escrows, not just copies them, because valuable things can't
 be copied.</p></div></div><div class="top"><p class="src"><a id="v:internalSpend" class="def">internalSpend</a> :: (<a href="Blockchain-Fae-Internal-IDs.html#t:HasEscrowIDs">HasEscrowIDs</a> valType, <a href="../adjunctions-4.3/Control-Monad-Representable-State.html#t:MonadState">MonadState</a> <a href="Blockchain-Fae-Internal-Contract.html#t:Escrows">Escrows</a> m, <a href="Blockchain-Fae.html#t:NFData">NFData</a> valType) =&gt; valType -&gt; m (<a href="Blockchain-Fae-Internal-Contract.html#t:WithEscrows">WithEscrows</a> valType) <a href="src/Blockchain.Fae.Internal.Contract.html#internalSpend" class="link">Source</a> <a href="#v:internalSpend" class="selflink">#</a></p><div class="doc"><p>Because we need to essentially <code>spend</code> a value internally, and we
 haven't defined that function yet.</p></div></div><div class="top"><p class="src"><a id="v:internalUseEscrow" class="def">internalUseEscrow</a> :: (<a href="Blockchain-Fae-Internal-IDs.html#t:HasEscrowIDs">HasEscrowIDs</a> argType, <a href="Blockchain-Fae-Internal-IDs.html#t:HasEscrowIDs">HasEscrowIDs</a> valType, <a href="Blockchain-Fae-Internal-Exceptions.html#t:Typeable">Typeable</a> argType, <a href="Blockchain-Fae-Internal-Exceptions.html#t:Typeable">Typeable</a> valType, <a href="../base-4.9.1.0/Data-Functor.html#t:Functor">Functor</a> s) =&gt; <a href="Blockchain-Fae-Internal-IDs.html#t:EntryID">EntryID</a> -&gt; argType -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeContract">FaeContract</a> s valType <a href="src/Blockchain.Fae.Internal.Contract.html#internalUseEscrow" class="link">Source</a> <a href="#v:internalUseEscrow" class="selflink">#</a></p><div class="doc"><p>Because we need to use escrows internally, specifically in
 <code><a href="Blockchain-Fae-Internal-Contract.html#v:runTXEscrows">runTXEscrows</a></code>.</p></div></div><div class="top"><p class="src"><a id="v:runTXEscrows" class="def">runTXEscrows</a> :: <span class="keyword">forall</span> a s. (<a href="Blockchain-Fae-Internal-IDs.html#t:HasEscrowIDs">HasEscrowIDs</a> a, <a href="../base-4.9.1.0/Data-Functor.html#t:Functor">Functor</a> s) =&gt; a -&gt; <a href="Blockchain-Fae-Internal-Contract.html#t:FaeContract">FaeContract</a> s a <a href="src/Blockchain.Fae.Internal.Contract.html#runTXEscrows" class="link">Source</a> <a href="#v:runTXEscrows" class="selflink">#</a></p><div class="doc"><p>Traverses all the escrows in a valuable object, picks out the
 transactional inputs, and executes them, replacing them with outputs.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.17.3</p></div></body></html>